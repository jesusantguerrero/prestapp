import{l as Y,z as H,P as K,d as k,m as Q,B as Z,f,a as n,b as d,w as u,u as o,t as V,g as _,h as U,a1 as ee,e as I,U as P,aa as te,E as F,C as g,W as oe,Y as le,A as ae,o as p,c as S,aj as se}from"./app-e7293397.js";import{p as T}from"./index-1a0c9adf.js";import{k as y,b as ne,z as w,v as ie,s as de}from"./atmosphere-ui-86b7f8ed.js";import{_ as ce}from"./AppButton.vue_vue_type_script_setup_true_lang-046c4e1c.js";import{_ as ue}from"./InvoiceTotals.vue_vue_type_style_index_0_lang-9e8793e7.js";import re from"./InvoiceGrid-960550dc.js";import{u as me}from"./usePaymentModal-ad844d5c.js";import{f as $}from"./index-c251e33c.js";import{_ as pe}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-3624ec38.js";import"./index-81f33ca2.js";import"./trash-b41c2bba.js";import"./index-9dc2d84c.js";import"./formatMoney-b7ef7683.js";import"./exact-math.node-9a256fc0.js";import"./IconTrash-b225eb02.js";import"./AtTable.vue_vue_type_script_setup_true_lang-805493b4.js";import"./customCell-f0a6687f.js";const x=r=>(oe("data-v-e3954cbc"),r=r(),le(),r),fe={class:"w-full py-2 rounded-md section"},ve={class:"section-body"},be={class:"invoice-body"},_e={class:"invoice-header-details"},ye=["src"],xe={key:1,class:"el-icon-plus avatar-uploader-icon"},Ve={class:"space-y-4 invoice-details"},ge={class:"invoice-form-row form-group"},we=x(()=>n("label",{for:"invoice-description"},"Description: ",-1)),De={class:"invoice-form-row form-group"},Fe=x(()=>n("label",{for:"invoice-description"},"Concept: ",-1)),he={class:"flex space-x-4"},Ee={class:"w-6/12 text-left"},Ce={key:0},Ne={key:0},ke={key:1},Ue=x(()=>n("strong",null,"CIF/NIF:",-1)),Ie={class:"flex justify-between w-6/12 space-x-4 text-left"},Pe={class:"w-full"},Se={class:"w-full"},Te={class:"totals-container"},$e={key:0,class:"flex text-left invoice-footer-details"},Oe={class:"w-full"},Be=x(()=>n("label",{for:""}," Footer ",-1)),qe={class:"w-full"},Le=x(()=>n("label",{for:"",class:"block"}," Notes ",-1)),Me=Y({__name:"InvoiceTemplate",props:{type:{type:String,default:"INVOICE"},user:Object,products:Array,clients:Array,invoiceData:[Object,null],availableTaxes:[Array,null],isEditing:Boolean},setup(r,{expose:O}){const v=r,B={expense:{contact:"Proveedor",documentNumber:"Bill Number",orderNumber:"P.O/S.O Number"},invoice:{contact:"Cliente",documentNumber:"No. factura",orderNumber:"No. Orden"}},D=t=>B[v.type.toLowerCase()][t],a=H({totalValues:{},totals:{subtotalField:"subtotal",totalField:"amount",discountField:"discountTotal",subtotalFormula(t){return t.quantity*t.price},totalFormula(t){return t.quantity*t.price},discountFormula(t){return t.quantity*t.price}},invoice:K({id:null,number:null,concept:null,date:new Date,due_date:new Date,client_id:null,footer:null,notes:null,payments:[],debt:0,status:"DRAFT",created_at:null,updated_at:null,taxes_included:!1}),selectedPayment:null,isPaymentDialogVisible:!1,modals:{email:{value:!1}},activeSections:[],tableData:[],client:null,imageUrl:"",isDraft:k(()=>!a.invoice.status||a.invoice.status.toLowerCase()=="draft"),section:k(()=>v.type.toLowerCase())}),q=t=>{t&&(t.date=T(t.date)||new Date,t.due_date=T(t.due_date)||new Date,Object.keys(t).forEach(e=>{a.invoice[e]=t[e]}),a.client=t.client,a.tableData=t.lines.sort((e,c)=>e.index>c.index?1:-1).map(e=>{var i;const c=(i=e.taxes)!=null&&i.length?se(e.taxes):[];return e.taxes=[...c,{id:"new"}],e})||[])};Q(()=>v.invoiceData,t=>{q(t)},{immediate:!0});const{openModal:L}=me(),M=t=>{L({data:{title:`Pagar ${l.concept}`,payment:t,endpoint:`/invoices/${t.payable_id}/payment/${t.id}`,due:t.amount,account_id:t.account_id,defaultConcept:t.concept}})},j=async t=>{await te.confirm(`Estas seguro de eliminar el pago ${t.concept}?`,"Eliminar pago")&&F.delete(`/payments/${t.id}`,{onSuccess(){ElNotification({message:`Pago ${unit.name} borrada con exito`,title:"Pago eliminada",type:"success"})}})},h=t=>{const e={...t,items:a.tableData.map((i,m)=>(i.index=m,i.quantity=parseFloat(i.quantity),i.price=parseFloat(i.price),i)).filter(i=>i.concept)};e.date=$(t.date||new Date,"yyyy-MM-dd"),e.due_date=$(t.due_date||e.date,"yyyy-MM-dd");const c=v.type!="INVOICE"?"EXPENSE":v.type;return e.resource_type_id=c,e.type=c,e.concept=e.concept||a.section,e.total=a.totalValues.total,e.discount=a.totalValues.discountTotal,e.subtotal=a.totalValues.subtotal,e.taxes=a.totalValues.taxes,delete e.lines,delete e.paymentDocs,delete e.client,e},E=(t,e,c,i)=>F[t](e,c,{onSuccess(){const m=c.type=="EXPENSE"?"bills":"invoices";F.replace(`/${m}/${c.id}`)}}),R=t=>{const e=h({...a.invoice,type:v.type});t&&(e.status=2);let c="post",i="/invoices";a.invoice.id&&(i=`/invoices/${a.invoice.id}`,c="put"),E(c,i,e)},z=t=>{const e=h(a.invoice);t&&(e.status=2);let c="post",i=`/invoices/${a.invoice.id}/clone`;E(c,i,e).then(m=>{getInvoice(m.id)}).catch(m=>{console.log(m)})},A=t=>{a.imageUrl=URL.createObjectURL(t.raw),a.invoice.logo=t},X=({rowIndex:t,taxes:e})=>{a.tableData[t].taxes=e},{invoice:l,totals:b,tableData:C,totalValues:G,isPaymentDialogVisible:J,isDraft:je}=Z(a);O({saveForm:R,cloneInvoice:z});const W=ae("accountsOptions",[]);return(t,e)=>{const c=g("el-upload"),i=g("ElCollapseItem"),m=g("ElCollapse"),N=g("ElDatePicker");return p(),f("section",fe,[n("div",ve,[n("div",be,[d(m,{modelValue:t.activeSections,"onUpdate:modelValue":e[2]||(e[2]=s=>t.activeSections=s),class:"w-full"},{default:u(()=>[d(i,{title:"Logo, concept and description",name:"header"},{default:u(()=>[n("div",_e,[d(c,{class:"avatar-uploader","v-model":o(l).logo,"show-file-list":!1,"on-change":A,"auto-upload":!1},{default:u(()=>[t.imageUrl?(p(),f("img",{key:0,src:t.imageUrl,class:"avatar"},null,8,ye)):(p(),f("i",xe))]),_:1},8,["v-model"]),n("div",Ve,[n("div",ge,[we,d(o(w),{type:"text",class:"form-control",name:"invoice-description",id:"invoice-description",modelValue:o(l).description,"onUpdate:modelValue":e[0]||(e[0]=s=>o(l).description=s)},null,8,["modelValue"])]),n("div",De,[Fe,d(o(w),{type:"text",class:"form-control",name:"invoice-description",id:"invoice-description",modelValue:o(l).concept,"onUpdate:modelValue":e[1]||(e[1]=s=>o(l).concept=s)},null,8,["modelValue"])])])])]),_:1})]),_:1},8,["modelValue"]),n("div",he,[n("div",Ee,[d(o(y),{label:D("contact")},{default:u(()=>[d(o(ie),{modelValue:o(l).client_id,"onUpdate:modelValue":e[3]||(e[3]=s=>o(l).client_id=s),selected:a.client,"onUpdate:selected":e[4]||(e[4]=s=>a.client=s),options:r.clients,label:"fullName","key-track":"id"},null,8,["modelValue","selected","options"])]),_:1},8,["label"]),a.client?(p(),f("div",Ce,[n("p",null,V(a.client.fullName),1),a.client.country?(p(),f("p",Ne,V(a.client.country),1)):_("",!0),a.client.tax_number?(p(),f("p",ke,[Ue,U(),n("span",null,V(a.client.tax_number),1)])):_("",!0),n("p",null,V(a.client.email),1)])):_("",!0),d(o(y),{label:"Cuenta",class:"w-4/12"},{default:u(()=>[d(o(de),{modelValue:o(l).account_id,"onUpdate:modelValue":e[5]||(e[5]=s=>o(l).account_id=s),selected:o(l).account,"onUpdate:selected":e[6]||(e[6]=s=>o(l).account=s),size:"large","default-expand-all":!0,options:o(W),label:"name","key-track":"id"},null,8,["modelValue","selected","options"])]),_:1})]),n("div",Ie,[n("div",Pe,[d(o(y),{label:"Fecha",class:"flex flex-col"},{default:u(()=>[o(l).date?(p(),S(N,{key:0,modelValue:o(l).date,"onUpdate:modelValue":e[7]||(e[7]=s=>o(l).date=s),size:"large",id:"invoice-date",type:"date",title:"seleccione una fecha",placeholder:"selecciona una fecha"},null,8,["modelValue"])):_("",!0)]),_:1}),d(o(y),{label:"Fecha Limite",class:"mt-2"},{default:u(()=>[o(l).due_date?(p(),S(N,{key:0,modelValue:o(l).due_date,"onUpdate:modelValue":e[8]||(e[8]=s=>o(l).due_date=s),size:"large",id:"invoice-due-date",type:"date",title:"seleccione una fecha",placeholder:"selecciona una fecha"},null,8,["modelValue"])):_("",!0)]),_:1})]),n("div",Se,[d(o(y),{label:D("documentNumber")},{default:u(()=>[d(o(w),{modelValue:o(l).number,"onUpdate:modelValue":e[9]||(e[9]=s=>o(l).number=s),type:"text",name:"invoice-number",id:"invoice-number"},null,8,["modelValue"])]),_:1},8,["label"]),d(o(y),{label:D("orderNumber"),class:"mt-2"},{default:u(()=>[d(o(w),{modelValue:o(l).order_number,"onUpdate:modelValue":e[10]||(e[10]=s=>o(l).order_number=s),type:"text",name:"invoice-order-number",id:"invoice-order-number"},null,8,["modelValue"])]),_:1},8,["label"])])])])]),d(re,{tableData:o(C),products:r.products,taxes:t.taxes,"is-editing":r.isEditing,"available-taxes":r.availableTaxes,onTaxesUpdated:X,class:"mt-10"},null,8,["tableData","products","taxes","is-editing","available-taxes"]),n("div",Te,[n("div",null,[d(o(ne),{label:"Taxes included",modelValue:o(l).taxes_included,"onUpdate:modelValue":e[11]||(e[11]=s=>o(l).taxes_included=s)},null,8,["modelValue"])]),d(ue,{tableData:o(C),"subtotal-field":o(b).subtotalField,"discount-field":o(b).discountField,payments:o(l).payments,"total-values":o(G),"total-field":o(b).totalField,subtotalFormula:o(b).subtotalFormula,discountFormula:o(b).discountFormula,totalFormula:o(b).totalFormula,"invoice-taxes":t.invoiceTaxes,"is-tax-included":o(l).taxes_included,onEditPayment:M,onDeletePayment:j},ee({_:2},[a.isDraft?void 0:{name:"add-payment",fn:u(()=>[n("div",null,[d(ce,{class:"w-full",onClick:e[12]||(e[12]=s=>J.value=!0)},{default:u(()=>[U(" Add Payment ")]),_:1})])]),key:"0"}]),1032,["tableData","subtotal-field","discount-field","payments","total-values","total-field","subtotalFormula","discountFormula","totalFormula","invoice-taxes","is-tax-included"])]),o(l).id?(p(),f("div",$e,[n("div",Oe,[Be,I(n("textarea",{name:"",class:"w-full border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",id:"",cols:"30",rows:"5","onUpdate:modelValue":e[13]||(e[13]=s=>o(l).footer=s)},null,512),[[P,o(l).footer]])]),n("div",qe,[Le,I(n("textarea",{name:"",class:"w-full border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",id:"",cols:"30",rows:"5","onUpdate:modelValue":e[14]||(e[14]=s=>o(l).notes=s)},null,512),[[P,o(l).notes]])])])):_("",!0)])])}}});const nt=pe(Me,[["__scopeId","data-v-e3954cbc"]]);export{nt as default};
