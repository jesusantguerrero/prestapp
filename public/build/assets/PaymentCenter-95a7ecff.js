import{z as T,m as M,l as w,P as z,r as j,d as D,c as g,w as d,E as $,C as O,o as y,b as r,a as p,u as n,t as k,g as h,f as G,h as P,M as I,a3 as J}from"./app-494b6f90.js";import{z as L}from"./atmosphere-ui-83e2a306.js";import{_ as E}from"./BaseSelect.vue_vue_type_style_index_1_lang-7b13fe11.js";import{a as q,_ as A}from"./BaseTable.vue_vue_type_style_index_0_lang-39691f37.js";import{_ as H}from"./AppLayout.vue_vue_type_style_index_0_lang-3aae0800.js";import{_ as K}from"./LoanSectionNav.vue_vue_type_script_setup_true_lang-185d9b4d.js";import{_ as U}from"./AppButton.vue_vue_type_script_setup_true_lang-6731c3fc.js";import{_ as B}from"./ButtonGroup.vue_vue_type_script_setup_true_lang-f813575d.js";import{f as F}from"./formatMoney-b7ef7683.js";import{_ as Q}from"./PaymentsCard.vue_vue_type_script_setup_true_lang-97a6b8c4.js";import"./customCell-9e9ed16f.js";import"./close-40de6817.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./PaymentFormModal.vue_vue_type_script_setup_true_lang-2fd658ef.js";import"./PaymentGrid-a2bc0bdb.js";import"./mathHelper-d6bc48cd.js";import"./exact-math.node-f7579f9b.js";import"./constants-0a903a05.js";import"./AccountSelect.vue_vue_type_script_setup_true_lang-93902e28.js";import"./AppFormField.vue_vue_type_style_index_0_lang-2eb2a149.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";import"./Modal.vue_vue_type_script_setup_true_lang-ca2f799a.js";import"./InvoiceFormModal.vue_vue_type_script_setup_true_lang-d4cb9813.js";import"./user-outline-c87acd59.js";import"./ClientFormModal.vue_vue_type_script_setup_true_lang-593db1f8.js";import"./ClientForm.vue_vue_type_script_setup_true_lang-7ced5882.js";import"./SectionNav.vue_vue_type_script_setup_true_lang-3cbc58a3.js";import"./usePaymentModal-f96f741a.js";import"./FastAccessOptions.vue_vue_type_script_setup_true_lang-ff3d4599.js";import"./menus-f4817d1f.js";import"./receipt-55266926.js";import"./document-664d61e3.js";import"./index-9dc2d84c.js";import"./index-3624ec38.js";const R=[{name:"loan_id",label:"Prestamo #"},{name:"client.display_name",label:"Cliente"},{name:"amount",label:"Monto del pagare",render(o){return F(o.amount)}},{name:"amount_paid",label:"Balance",render(o){return F(o.amount_due)}},{name:"payment",label:"Monto de reembolso"}],W=o=>o.reduce((m,l)=>{const a=typeof l=="string"?l:l.name;return m[a]=null,m},{}),X=(o,m)=>Object.entries(o).reduce((l,[a,f])=>(f&&(l[a]=f[m]),l),{}),Y=(o,m,l="id")=>{const a=T(W(o));return M(()=>a,_=>{const v=X(_,l);m.get(location.pathname,{filters:v},{preserveState:!0})},{deep:!0}),{filters:a,reset:()=>{m.get(location.pathname,{},{preserveState:!0}),Object.keys(a).forEach(_=>{a[_]=""})}}},Z={class:"py-10 mx-auto md-24 md:mt-0 sm:px-6 lg:px-8"},ee={class:"flex space-x-4 w-full rounded-md"},te={class:"rounded-md bg-base-lvl-3 mt-4"},ae={class:"px-4 pb-10"},oe=["onClick"],le={key:0,class:"w-full text-right px-4 md:px-0 space-x-4 pb-4"},Ge=w({__name:"PaymentCenter",props:{invoices:null,loans:null,clients:null,currentTab:null},setup(o){const m=o,l=z({client:null,account:null,payments:[]}),{filters:a,reset:f}=Y(["client","loan","search"],$),_=s=>`Prestamo ${s.id} (${s.amount}) (debt: $${s.debt})`,v=(s,t)=>{t.payment=t.amount_due},N=()=>{var e,b,C;const s=(e=payments.value)==null?void 0:e.reduce((c,u)=>(u.amount&&c.push({id:u.id,rent_id:u.rent_id,amount:u.payment,original_amount:u.amount}),c),[]);if(!s.length){I({type:"error",message:"Seleccione al menos un pago",title:"Error de pago"});return}const t=s[0].rent_id,V={client_id:(b=l.client)==null?void 0:b.id,account_id:(C=l.account)==null?void 0:C.id,rent_id:t,payments:s,total:s.reduce((c,u)=>c+parseFloat(u.amount),0)};J.post(`/properties/${t}/transactions/refund`,V).then(({data:c})=>{console.log(c)})},x={pending:{label:"Pendientes"},all:{label:"Todos"},payments:{label:"Pagos"}},i=j(m.currentTab);M(i,()=>{$.reload({data:{tab:i.value}})});const S=D(()=>i.value=="payments");return(s,t)=>{const V=O("ElCheckbox");return y(),g(H,{title:"Centro de pago de prestamos"},{header:d(()=>[r(K,null,{actions:d(()=>[r(B,{values:x,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:"hidden md:flex"},null,8,["modelValue"])]),_:1})]),default:d(()=>[p("main",Z,[r(B,{values:x,modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"w-full mt-4 md:hidden"},null,8,["modelValue"]),p("header",ee,[r(q,{modelValue:n(a).search,"onUpdate:modelValue":t[2]||(t[2]=e=>n(a).search=e),modelModifiers:{lazy:!0},class:"w-full md:flex",onClear:t[3]||(t[3]=e=>n(f)())},null,8,["modelValue"]),r(E,{class:"w-full",modelValue:n(a).client,"onUpdate:modelValue":t[4]||(t[4]=e=>n(a).client=e),options:o.clients,placeholder:"Cliente",label:"display_name","track-by":"id"},null,8,["modelValue","options"]),r(E,{class:"w-full",modelValue:n(a).loan,"onUpdate:modelValue":t[5]||(t[5]=e=>n(a).loan=e),"track-by":"id",options:o.loans,"hide-selected":!1,"custom-label":_,placeholder:"Categoria"},null,8,["modelValue","options"])]),p("section",te,[p("article",ae,[r(A,{layout:n(S)?"grid":"table",cols:n(R),"table-data":o.invoices.data},{loan_id:d(({scope:{row:e}})=>[p("div",{class:"items-center space-x-2 flex cursor-pointer",onClick:b=>v(!e.amount,e)},[r(V,{"model-value":!!e.payment},null,8,["model-value"]),p("span",null," Prestamo #"+k(e.loan_id),1)],8,oe)]),payment:d(({scope:{row:e}})=>[e.amount_due>0?(y(),g(n(L),{key:0,class:"rounded-md shadow-none border-body-1/10",modelValue:e.payment,"onUpdate:modelValue":b=>e.payment=b,"number-format":!0},null,8,["modelValue","onUpdate:modelValue"])):h("",!0),p("span",null,k(e.amount_due),1)]),card:d(({row:e})=>[e?(y(),g(Q,{key:0,payment:e},null,8,["payment"])):h("",!0)]),_:1},8,["layout","cols","table-data"])]),i.value=="pending"&&n(a).client?(y(),G("footer",le,[r(U,{variant:"neutral"},{default:d(()=>[P(" Cancelar")]),_:1}),r(U,{variant:"secondary",onClick:N},{default:d(()=>[P(" Guardar y Pagar")]),_:1})])):h("",!0)])])]),_:1})}}});export{Ge as default};
