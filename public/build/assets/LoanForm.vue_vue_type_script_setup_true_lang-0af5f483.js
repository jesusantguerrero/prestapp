import{F as B,z as c,s as T,k as L}from"./atmosphere-ui-86b7f8ed.js";import{_ as U}from"./AppButton.vue_vue_type_script_setup_true_lang-046c4e1c.js";import{_ as P}from"./InstallmentTable.vue_vue_type_script_setup_true_lang-cbcb4ed7.js";import{l as E,z as I,m as O,ag as F,d as V,r as v,f as M,a as d,b as t,w as s,c as z,g as _,u as n,C as R,o as p,h as g,N as S}from"./app-e7293397.js";import{g as j,a as G}from"./generateInstallments-d1542e70.js";import{l as H}from"./constants-0a903a05.js";import{f as y}from"./index-9dc2d84c.js";import{_ as Y}from"./BaseSelect.vue_vue_type_style_index_1_lang-cbd59430.js";import{_ as b}from"./FormSection.vue_vue_type_script_setup_true_lang-bb2801db.js";import{_ as J}from"./LoanSummary.vue_vue_type_script_setup_true_lang-bea8f4d9.js";import{_ as K}from"./AccountSelect.vue_vue_type_script_setup_true_lang-cb870c82.js";import{_ as r}from"./AppFormField.vue_vue_type_style_index_0_lang-d6998fd8.js";import{a as Q}from"./index-17a9d477.js";const W={class:"w-full md:w-8/12 p-4 bg-white rounded-md shadow-md text-body-1"},X={class:"flex flex-col md:flex-row md:space-x-4"},Z=d("div",null,null,-1),ee={class:"flex flex-col md:flex-row md:space-x-4"},le={class:"flex flex-col md:flex-row w-full md:space-x-4"},te={class:"flex space-x-4"},ae={class:"flex space-x-4"},se={class:"w-full md:w-4/12 mt-4 md:mt-0 rounded-md bg-white shadow-md relative overflow-hidden grid gap-4 grid-cols-1 grid-rows-[1fr_50px]"},oe={class:"w-full px-4 overflow-hidden text-body-1"},ne=d("header",{class:"py-4 font-bold"},"Resumen de prestamo",-1),de={key:0,class:"mt-4"},re=d("h4",{class:"text-xl font-bold"},"Tabla de amortización",-1),ue={class:"flex justify-between w-full px-4 py-1"},ke=E({__name:"LoanForm",props:{loans:null,isLoading:{type:Boolean},canSave:{type:Boolean}},emits:["update:isLoading","update:canSave","submit"],setup(D,{expose:N,emit:A}){const m=D,e=I({id:null,client_id:null,client:void 0,amount:0,repayment_count:0,interest_rate:0,frequency:"MONTHLY",disbursement_date:new Date,first_repayment_date:Q(new Date,1),grace_days:0,late_fee:0,installments_paid:0,closing_fees:0,category_id:null,source_type:null,source_account_id:null,sourceAccount:null});O(()=>m.loans,o=>{var l;o&&(Object.keys(e).forEach(u=>{e[u]=o[u]||e[u]}),e.client_id=((l=m.loans.client)==null?void 0:l.id)??1,e.client=m.loans.client)},{immediate:!0,deep:!0}),F(()=>{e.disbursement_date&&e.frequency&&S(()=>{e.first_repayment_date=j(e.disbursement_date,e.frequency,!1)})}),V(()=>{var o,l;return(o=m.loans)!=null&&o.id?`Prestamo ${(l=m.loans.client)==null?void 0:l.fullName}`:"Crear Prestamo"}),V(()=>{var o;return(o=m.loans)!=null&&o.id?"Guardar prestamo":"Registrar Prestamo"});const i=v(null);F(()=>{const o=y(e.first_repayment_date,"yyyy-MM-dd");e.amount&&e.repayment_count&&(i.value=G({interest_rate:e.interest_rate,amount:e.amount,repayment_count:e.repayment_count,first_repayment_date:o,frequency:e.frequency}))});const x=V(()=>{var o,l;return i.value&&((l=(o=i.value)==null?void 0:o.payments)==null?void 0:l.length)}),w=v(!1),k=()=>{var l,u;const o={...e,date:y(e.disbursement_date,"yyyy-MM-dd"),disbursement_date:y(e.disbursement_date,"yyyy-MM-dd"),first_repayment_date:y(e.first_repayment_date,"y-M-d"),client_id:e.client.id,source_type:(l=e.sourceType)==null?void 0:l.id,source_account_id:(u=e.sourceAccount)==null?void 0:u.id};w.value=!0,A("submit",{...o,installments:i.value.payments})},f=v(!1);return N({submit:k}),(o,l)=>{var q,C,h,$;const u=R("ElDatePicker");return p(),M("main",null,[d("section",W,[t(b,{title:"Datos del cliente",class:"w-full","section-class":"w-full"},{default:s(()=>[t(r,{label:"Cliente",class:"w-full",required:""},{default:s(()=>[t(Y,{modelValue:e.client,"onUpdate:modelValue":l[0]||(l[0]=a=>e.client=a),"track-by":"id",endpoint:"/api/clients",placeholder:"Selecciona un cliente",label:"display_name",class:"w-full",required:""},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{title:"Terminos de prestamo","section-class":"w-full"},{default:s(()=>[d("section",X,[t(r,{label:"Monto a prestar",class:"w-full",required:""},{default:s(()=>[t(n(c),{modelValue:e.amount,"onUpdate:modelValue":l[1]||(l[1]=a=>e.amount=a),"number-format":"",rounded:""},null,8,["modelValue"])]),_:1}),t(r,{label:"Interés mensual",class:"w-full",required:""},{default:s(()=>[t(n(c),{modelValue:e.interest_rate,"onUpdate:modelValue":l[2]||(l[2]=a=>e.interest_rate=a),"number-format":"",max:"100",min:"0",rounded:""},{suffix:s(()=>[Z]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"Cuotas",class:"w-full",required:""},{default:s(()=>[t(n(c),{modelValue:e.repayment_count,"onUpdate:modelValue":l[3]||(l[3]=a=>e.repayment_count=a),rounded:""},null,8,["modelValue"])]),_:1})]),d("section",ee,[t(r,{label:"Fecha de desembolso",required:""},{default:s(()=>[t(u,{modelValue:e.disbursement_date,"onUpdate:modelValue":l[4]||(l[4]=a=>e.disbursement_date=a),size:"large",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Fecha de primer pago",required:""},{default:s(()=>[t(u,{modelValue:e.first_repayment_date,"onUpdate:modelValue":l[5]||(l[5]=a=>e.first_repayment_date=a),size:"large",class:"w-full"},null,8,["modelValue"])]),_:1}),t(r,{label:"Frecuencia",class:"w-full",required:""},{default:s(()=>[t(n(T),{options:n(H),modelValue:e.frequency,"onUpdate:modelValue":l[6]||(l[6]=a=>e.frequency=a)},null,8,["options","modelValue"])]),_:1})])]),_:1}),t(U,{class:"w-full",onClick:l[7]||(l[7]=a=>f.value=!f.value)},{default:s(()=>[g(" Opciones Avanzadas")]),_:1}),f.value?(p(),z(b,{key:0,title:"Avanzadas","section-class":"w-full",class:"mt-4"},{default:s(()=>[d("section",le,[t(r,{label:"Dias de gracia",class:"w-full"},{default:s(()=>[t(n(c),{modelValue:e.grace_days,"onUpdate:modelValue":l[8]||(l[8]=a=>e.grace_days=a),rounded:""},null,8,["modelValue"])]),_:1}),t(r,{label:"Interes de mora",class:"w-full"},{default:s(()=>[t(n(c),{modelValue:e.late_fee,"onUpdate:modelValue":l[9]||(l[9]=a=>e.late_fee=a),rounded:""},null,8,["modelValue"])]),_:1}),_("",!0)]),d("section",te,[t(r,{label:"Gastos de cierre",class:"w-full"},{default:s(()=>[t(n(c),{modelValue:e.closing_fees,"onUpdate:modelValue":l[11]||(l[11]=a=>e.closing_fees=a),rounded:""},null,8,["modelValue"])]),_:1}),t(n(L),{class:"w-full hidden"})])]),_:1})):_("",!0),f.value?(p(),z(b,{key:1,title:"Contabilidad","section-class":"w-full",class:"mt-4"},{default:s(()=>[d("section",ae,[t(r,{label:"Cuenta origen",field:"sourceAccount",class:"w-full",required:""},{default:s(()=>[t(K,{modelValue:e.sourceAccount,"onUpdate:modelValue":l[12]||(l[12]=a=>e.sourceAccount=a)},null,8,["modelValue"])]),_:1})])]),_:1})):_("",!0)]),d("article",se,[d("section",oe,[ne,t(J,{payment:(q=i.value)==null?void 0:q.payment,"total-interest":(C=i.value)==null?void 0:C.totalInterest,"total-debt":(h=i.value)==null?void 0:h.totalDebt},null,8,["payment","total-interest","total-debt"]),n(x)?(p(),M("section",de,[re,t(P,{installments:($=i.value)==null?void 0:$.payments,"hidden-cols":["loan_id","actions"]},null,8,["installments"])])):_("",!0)]),d("footer",ue,[t(n(B),{class:"font-bold text-red-400 rounded-md bg-base-lvl-2",variant:"secondary",onClick:l[13]||(l[13]=a=>o.goToList())},{default:s(()=>[g(" Cancelar ")]),_:1}),t(U,{processing:w.value,variant:"secondary",onClick:k,disabled:!n(x)||w.value},{default:s(()=>[g(" Registar Prestamo ")]),_:1},8,["processing","disabled"])])])])}}});export{ke as _};
