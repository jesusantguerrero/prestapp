import{k as $,r as C,l as g,d as E,c as p,w as d,u as n,$ as F,o as c,a as r,b as u,h as f,t as R,a0 as q,e as B,R as H,g as A,M as k}from"./app-9b138141.js";import{N as T,V,R as m,a as O}from"./atmosphere-ui-18006871.js";import{_ as D}from"./AppButton.vue_vue_type_script_setup_true_lang-70b35c26.js";import j from"./PaymentGrid-bb2f1c2e.js";import{M as z}from"./mathHelper-7298fc42.js";import{p as b}from"./constants-0a903a05.js";import{_ as G}from"./AccountSelect.vue_vue_type_script_setup_true_lang-79716ae8.js";import{f as N}from"./index-c251e33c.js";const I={class:""},L={class:"flex space-x-4"},J={class:"flex space-x-4"},K={class:"w-full text-left"},Q=r("label",{for:""},"Notes",-1),W={class:"space-x-2 dialog-footer"},ne=$({__name:"PaymentFormModal",props:{modelValue:Boolean,defaultConcept:{type:String,required:!0},defaultAmount:{type:Number,required:!0},payment:[Object,null],due:Number,endpoint:{type:String,required:!0},accountsEndpoint:{type:String,default:"/api/accounts"}},emits:["update:modelValue","saved"],setup(y,{emit:i}){const l=y,_={amount:0,account_id:""},e=C(w()),x=()=>{e.value=w()};function w(){var o;return{..._,concept:l.defaultConcept,amount:l.due,payment_method_id:b[0].id,paymentMethod:b[0],payment_date:new Date,...(o=l.payment)!=null&&o.id?l.payment:{}}}g(()=>l.defaultConcept,o=>{e.value.concept=o},{immediate:!0}),g(()=>l.due,o=>{e.value.id||(e.value.amount=o)},{immediate:!0}),g(()=>l.payment,o=>{o&&x()},{deep:!0,immediate:!0});const P=E(()=>{var o;return(o=e.value.documents)==null?void 0:o.reduce((a,t)=>z.sum(a,t.payment),0)}),s=C(!1);function h(){var a;if(s.value)return;if(!e.id){U();return}s.value=!0;const o={payment_date:N(e.value.payment_date||new Date,"yyyy-MM-dd"),amount:e.value.amount,concept:e.value.concept,payment_method_id:e.value.payment_method,account_id:e.value.account_id,reference:e.value.reference,notes:e.value.notes,documents:(a=e.value.documents)==null?void 0:a.filter(t=>t.payment)};axios.post(l.endpoint,o).then(()=>{v(!0),i("saved")}).catch(t=>{console.log(t),k({type:"error",message:t.response?t.response.data.status.message:"Ha ocurrido un error"})}).finally(()=>{s.value=!1})}function U(){var a;if(!e.value.amount){k({type:"error",message:"should specify an amount"});return}s.value=!0;const o={resource_id:l.resourceId,payment_date:N(e.value.payment_date||new Date,"yyyy-MM-dd"),amount:e.value.amount,concept:e.value.concept,payment_method_id:e.value.payment_method,account_id:e.value.account_id,reference:e.value.reference,notes:e.value.notes,documents:(a=e.value.documents)==null?void 0:a.filter(t=>t.payment)};axios.post(l.endpoint,o).then(()=>{v(!0),i("saved")}).catch(t=>{console.log(t),notify({type:"error",message:t.response?t.response.data.status.message:"Ha ocurrido un error"})}).finally(()=>{s.value=!1})}function S(){var a;const o=l.endpoint?`${l.endpoint}`:`/invoice/${l.payment.resource_id}/payments/${(a=l.payment)==null?void 0:a.id}`;axios.delete(o).then(()=>{i("saved"),v(!0)}).catch(t=>{notify({type:"error",message:t.response?t.response.data.status.message:"Ha ocurrido un error"})})}function v(o){e.value={..._,concept:l.defaultConcept},o&&M(!1)}function M(o){i("update:modelValue",o)}return(o,a)=>(c(),p(n(F),{title:"Pagar prestamo",onOpen:a[12]||(a[12]=t=>x()),"model-value":y.modelValue,"onUpdate:modelValue":a[13]||(a[13]=t=>o.$emit("update:modelValue",t))},{footer:d(()=>[r("div",W,[u(n(T),{onClick:a[9]||(a[9]=t=>M(!1)),class:"bg-white border rounded-md text-gray"},{default:d(()=>[f(" Cancel ")]),_:1}),e.value.id?(c(),p(D,{key:0,class:"text-white bg-blue-500",onClick:a[10]||(a[10]=t=>S())},{default:d(()=>[f(" Delete ")]),_:1})):(c(),p(D,{key:1,onClick:a[11]||(a[11]=t=>h()),disabled:s.value,loading:s.value},{default:d(()=>[f(" Efectuar pago ")]),_:1},8,["disabled","loading"]))])]),default:d(()=>[r("div",I,[r("section",L,[u(n(m),{class:"w-full text-left",label:"Concepto"},{default:d(()=>[u(n(V),{type:"text",class:"form-control",name:"invoice-description",id:"invoice-description",modelValue:e.value.concept,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.concept=t),rounded:""},null,8,["modelValue"])]),_:1}),u(n(m),{class:"w-full text-left",label:"Referencia"},{default:d(()=>[u(n(V),{type:"text",class:"form-control",name:"invoice-description",id:"invoice-description",modelValue:e.value.reference,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.reference=t),rounded:""},null,8,["modelValue"])]),_:1}),u(n(m),{class:"w-full text-left",label:"Monto Recibido"},{default:d(()=>[u(n(V),{class:"form-control","number-format":"",modelValue:e.value.amount,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.amount=t),rounded:"",required:""},null,8,["modelValue"]),f(" "+R(n(P)),1)]),_:1})]),r("section",J,[u(n(m),{class:"w-5/12 mb-5 text-left",label:"Cuenta de Pago"},{default:d(()=>[u(G,{endpoint:y.accountsEndpoint,modelValue:e.value.paymentAccount,"onUpdate:modelValue":[a[3]||(a[3]=t=>e.value.paymentAccount=t),a[4]||(a[4]=t=>e.value.account_id=t==null?void 0:t.id)],placeholder:"Selecciona una cuenta"},null,8,["endpoint","modelValue"])]),_:1}),u(n(m),{class:"w-3/12 mb-5 text-left",label:"Metodo de Pago"},{default:d(()=>[u(n(O),{modelValue:e.value.payment_method_id,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.payment_method_id=t),selected:e.value.paymentMethod,"onUpdate:selected":a[6]||(a[6]=t=>e.value.paymentMethod=t),options:n(b),placeholder:"Seleccione metodo de pago",class:"w-full",label:"name","key-track":"id"},null,8,["modelValue","selected","options"])]),_:1}),u(n(m),{label:"Fecha de pago",class:"w-3/12"},{default:d(()=>[u(n(q),{modelValue:e.value.payment_date,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value.payment_date=t),size:"large",class:"w-full",rounded:""},null,8,["modelValue"])]),_:1})]),r("div",K,[Q,B(r("textarea",{class:"w-full px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:border-gray-400","onUpdate:modelValue":a[8]||(a[8]=t=>e.value.notes=t),cols:"3",rows:"3"},null,512),[[H,e.value.notes]])]),e.value.documents?(c(),p(j,{key:0,"table-data":e.value.documents,"available-taxes":[]},null,8,["table-data"])):A("",!0)])]),_:1},8,["model-value"]))}});export{ne as _};
