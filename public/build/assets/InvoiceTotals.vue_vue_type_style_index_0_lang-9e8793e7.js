import{_ as q}from"./trash-b41c2bba.js";import{l as w,z as B,d as y,m as D,B as I,f as d,a,t as i,u as e,F as $,j as F,g as x,k as N,o as u,p as C,h as M,b as S,w as O}from"./app-e7293397.js";import{f as A}from"./index-9dc2d84c.js";import{e as v}from"./exact-math.node-9a256fc0.js";import{_ as E}from"./AppButton.vue_vue_type_script_setup_true_lang-046c4e1c.js";import{f as _}from"./formatMoney-b7ef7683.js";const L={class:"invoice-totals"},R={class:"total-labels"},z=a("span",{class:"label"},"Subtotal: ",-1),P={class:"value"},G={class:"total-labels"},H={class:"label"},J={class:"value"},K={class:"total-labels total-remark"},Q=a("span",{class:"label"}," Total: ",-1),U={class:"value"},W={key:1},X=["onClick"],Y={class:"label flex"},Z={class:"value flex items-center justify-end text-right"},tt={class:"total-labels total-remark"},et=a("span",{class:"label"}," Deuda: ",-1),at={class:"value"},ut=w({__name:"InvoiceTotals",props:{tableData:{type:Array,required:!0},subtotalField:{type:String,required:!0},discountField:{type:String,required:!0},payments:{type:Array},totalField:{type:String,required:!0},totalValues:{type:Object,required:!0},isTaxIncluded:{type:Boolean,default:!1}},emits:["edit-payment","delete-payment"],setup(h,{emit:st}){const r=h,j=(s,t)=>v.formula(`(${s} / ((100 + ${t}) / 100))`),l=B({totals:y(()=>r.tableData.reduce((t,p)=>{const o=p[r.totalField];let c=0,m=0;return p.taxes.forEach(n=>{const T=`${n.label||n.name} ${n==null?void 0:n.rate}%`;if(T&&n.rate){const k=r.isTaxIncluded?j(o,n.rate):o,g=v.formula(`${k} * (${n.rate} / ${100})`)*(n.type??1);t.taxes[T]=(t.taxes[T]||0)+(g||0),t.taxesTotal+=g,c+=g,m+=k}}),m=m||o,t.subtotal+=m,t.discountTotal+=Number(p[r.discountField]),t.total+=v.add(m,c??0),t.taxesTotal+=c,t},{total:0,discountTotal:0,subtotal:0,taxesTotal:0,taxes:{}})),hasTaxes:y(()=>Object.keys(l.totals.taxes).length>0),paymentTotal:y(()=>r.payments&&r.payments.length?r.payments.reduce((s,t)=>s+=parseFloat(t.amount),0):0),debt:y(()=>l.totals.total-l.paymentTotal)});D(()=>l.totals,()=>{l.totals&&Object.keys(l.totals).length&&Object.keys(l.totals).forEach(s=>{r.totalValues[s]=l.totals[s]})},{deep:!0,immediate:!0});const{totals:b,debt:f,hasTaxes:V,paymentTotal:ot}=I(l);return(s,t)=>{const p=q;return u(),d("div",L,[a("p",R,[z,a("span",P,i(e(_)(e(b).subtotal)),1)]),e(V)?(u(!0),d($,{key:0},F(e(b).taxes,(o,c)=>(u(),d("p",G,[a("span",H,i(c)+": ",1),a("span",J,i(e(_)(o)),1)]))),256)):x("",!0),a("p",K,[Q,a("span",U,i(e(_)(e(b).total)),1)]),h.payments&&h.payments.length?(u(),d("div",W,[(u(!0),d($,null,F(h.payments,o=>(u(),d("i",{class:"text-green-500 total-labels payment-label group",key:o.id,onClick:C(c=>s.$emit("edit-payment",o),["stop"])},[a("p",Y,"Pagado en "+i(e(A)(o.payment_date)),1),a("p",Z,[M(" - "+i(e(_)(o.amount))+" ",1),S(E,{class:"text-gray hover:text-error group-hover:flex hidden",onClick:C(c=>s.$emit("delete-payment",o),["stop"])},{default:O(()=>[S(p,{class:"ml-2"})]),_:2},1032,["onClick"])])],8,X))),128))])):x("",!0),a("p",tt,[et,a("span",at,i(e(_)(e(f))),1)]),e(f)?N(s.$slots,"add-payment",{key:2,"slotScope:scope":{debt:e(f)}}):x("",!0)])}}});export{ut as _};
