import{V as f,a as C,B as D}from"./atmosphere-ui-8913659c.js";import{I as b}from"./IconTrash-96067300.js";import{f as A}from"./formatMoney-b7ef7683.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import{z as E,d as $,p as B,B as q,f as y,b as u,a4 as I,w as m,u as d,o as x,a as p,D as R,F as G,j as N,h as M,t as v,c as O}from"./app-b9464164.js";const w=[{label:"Items",name:"item",type:"custom",fixed:"true",class:"text-primary text-left",headerClass:"text-left"},{label:"Quantity",name:"quantity",width:"100",type:"custom",class:"text-primary text-right",headerClass:"text-right"},{label:"Discount %",name:"discount",width:"100",type:"custom",class:"text-primary text-right",headerClass:"text-right"},{label:"Price",name:"price",width:"150",type:"custom",class:"text-primary text-right",headerClass:"text-right"},{label:"Taxes",name:"taxes",width:"150",type:"custom",class:"text-primary text-center",headerClass:"text-center",render(t){return t.taxes.map(r=>r.label+" "+r.rate+"%").join(", ")}},{label:"Amount",name:"amount",width:"120",type:"calc",class:"text-primary text-right",headerClass:"text-right",formula(t){const r=Number(t.discount,0);t.subtotal=t.quantity*t.price,t.discountTotal=t.subtotal*r/100;const o=t.subtotal-t.discountTotal;return t.amount=o,A(o)}},{name:"actions"}];const S={class:"w-full"},j={class:"d-flex"},F={key:1},L={class:"space-y-2"},P=["onClick"],z=["onClick"],Q={__name:"InvoiceGrid",props:{tableData:{type:Array,default(){return[]}},availableTaxes:{type:Array,default(){return[]}},products:{type:Array,default(){return[]}},resourceUrl:{type:String,default:"/services?filter[name]=%${query}%&relationships=stock"},isEditing:{type:Boolean,default:!0},taxes:{type:Array,default(){return[]}}},emits:["taxes-updated"],setup(t,{emit:r}){const o=t,c=E({cleaveOptions:{percent:{numericOnly:!0,blocks:[3]},money:{decimal:".",thousands:",",precision:2,masked:!1}},services:[],isLoading:!1,rowToAdd:{},addMode:!1,renderedCols:$(()=>o.isEditing?w:w.filter(s=>s.name!="actions"))}),h=()=>{var l,e,a,n;const s=(l=c.rowToAdd.taxes)!=null&&l.length?c.rowToAdd.taxes:[];o.isEditing&&(!o.tableData.length||o.tableData.at(-1).concept)&&o.tableData.push({product_name:(e=c.rowToAdd)==null?void 0:e.name,concept:(a=c.rowToAdd)==null?void 0:a.name,product_id:c.rowToAdd.id,quantity:1,discount:0,price:((n=c.rowToAdd.price)==null?void 0:n.value)||0,amount:0,taxes:[...s,{id:"new"}]})},_=(s,l)=>{if(!confirm("Do you want to delete this?"))return;const a={...l};o.tableData.splice(s,1),r("deleted",a)},V=(s,l,e)=>{const a=o.tableData[s],n=o.availableTaxes.find(i=>e==i.name);a.taxes[l]=n,r("taxes-updated",{rowIndex:s,taxes:a.taxes})},k=(s,l)=>{const e=o.tableData[s];if(e.taxes.length>1){const a=e.taxes.filter((n,i)=>i!==l);r("taxes-updated",{rowIndex:s,taxes:a})}};B(()=>{h()});const{renderedCols:T,cleaveOptions:g}=q(c);return(s,l)=>(x(),y("div",S,[u(d(D),{cols:d(T),tableData:t.tableData,"hide-empty-text":!0},I({item:m(({scope:e})=>[p("div",j,[t.isEditing?(x(),O(d(f),{key:0,name:"",modelValue:e.row.concept,"onUpdate:modelValue":a=>e.row.concept=a,class:"form-control",rounded:""},null,8,["modelValue","onUpdate:modelValue"])):(x(),y("span",F,v(e.row.concept),1))])]),_:2},[t.isEditing?{name:"quantity",fn:m(({scope:e})=>[u(d(f),{name:"",min:"1",type:"number",modelValue:e.row.quantity,"onUpdate:modelValue":a=>e.row.quantity=a,class:"text-right form-control",rounded:""},null,8,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0,t.isEditing?{name:"discount",fn:m(({scope:e})=>[u(d(f),{class:"text-right form-control",type:"number",max:"100",min:"0",rounded:"",options:d(g).percent,modelValue:e.row.discount,"onUpdate:modelValue":a=>e.row.discount=a},null,8,["options","modelValue","onUpdate:modelValue"])]),key:"1"}:void 0,t.isEditing?{name:"price",fn:m(({scope:e})=>[p("div",L,[u(d(f),R({modelValue:e.row.price,"onUpdate:modelValue":a=>e.row.price=a},d(g).money,{"number-format":"",rounded:"",class:"text-right"}),null,16,["modelValue","onUpdate:modelValue"])])]),key:"2"}:void 0,t.isEditing?{name:"taxes",fn:m(({scope:e})=>[(x(!0),y(G,null,N(e.row.taxes,(a,n)=>(x(),y("div",{class:"flex items-center w-full mx-auto",key:`tax-${n}`},[u(d(C),{options:t.availableTaxes,modelValue:e.row.taxes[n].tax_id,"onUpdate:modelValue":[i=>e.row.taxes[n].tax_id=i,i=>V(e.$index,n,i)],selected:e.row.taxes[n],"onUpdate:selected":i=>e.row.taxes[n]=i,placeholder:"Tax","option-template":"${name} - ${rate}%",label:"name","key-track":"id",class:"w-full"},null,8,["options","modelValue","onUpdate:modelValue","selected","onUpdate:selected"]),M(" "+v(a.name)+" ",1),p("button",{class:"h-10 px-2 mt-auto ml-2 transition border focus:outline-none hover:text-gray-900 hover:bg-gray-200",onClick:i=>k(e.$index,n)},[u(b,{class:"w-4 h-4 text-gray-400"})],8,P)]))),128))]),key:"3"}:void 0,t.isEditing?{name:"actions",fn:m(({scope:e})=>[p("button",{onClick:a=>_(e.$index,e.row),class:"invoice-grid__remove-row"},[u(b,{class:"w-4 h-4 text-gray-400"})],8,z)]),key:"4"}:void 0,t.isEditing?{name:"append",fn:m(()=>[p("button",{onClick:l[0]||(l[0]=e=>h()),class:"invoice-grid__add-row"},"Add Row")]),key:"5"}:void 0]),1032,["cols","tableData"])]))}},Y=U(Q,[["__scopeId","data-v-03515189"]]);export{Y as default};
