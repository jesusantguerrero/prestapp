import{_ as S}from"./close-40de6817.js";import{l as z,r as w,m as p,d as k,c as O,w as n,u,$ as P,o as h,a as d,t as M,b as o,h as f,a0 as T,f as j,g as H,e as q,U as A,M as D}from"./app-494b6f90.js";import{F as G,z as $,k as L}from"./atmosphere-ui-83e2a306.js";import{_ as R}from"./AppButton.vue_vue_type_script_setup_true_lang-6731c3fc.js";import{_ as U}from"./BaseSelect.vue_vue_type_style_index_1_lang-7b13fe11.js";import{M as J}from"./mathHelper-d6bc48cd.js";import{p as F}from"./constants-0a903a05.js";import{_ as c}from"./AppFormField.vue_vue_type_style_index_0_lang-2eb2a149.js";import{f as K}from"./index-c251e33c.js";const Q={class:"border-b -mx-6 -mt-6 -mr-10 bg-secondary/80 text-white py-4 px-4 flex items-center justify-between"},W={class:"font-bold text-xl"},X={class:"-mt-10"},Y={class:"flex space-x-4"},Z={class:"flex"},ee={key:0,class:"mt-4 flex space-x-4"},te={class:"space-x-2 flex justify-end"},me=z({__name:"InvoiceFormModal",props:{modelValue:{type:Boolean},defaultConcept:null,defaultAmount:null,payment:null,due:{default:0},endpoint:null,title:{default:"Crear factura"},hideClientOptions:{type:Boolean},clientId:null,rentId:null,type:{default:"expense"}},emits:["update:modelValue","saved"],setup(i,{emit:v}){const s=i,y={amount:0,account_id:""},e=w(x()),b=()=>{e.value=x()};function x(){return{...y,concept:s.defaultConcept,amount:s.due??0,payment_method_id:F[0].id,paymentMethod:F[0],date:new Date}}p(()=>s.defaultConcept,a=>{e.value.concept=a},{immediate:!0}),p(()=>s.due,a=>{e.value.id||(e.value.amount=a)},{immediate:!0}),p(s.payment,a=>{a&&b()},{deep:!0,immediate:!0});const B=k(()=>{var a;return(a=e.value.documents)==null?void 0:a.reduce((t,m)=>J.sum(t,m.payment),0)}),I=k(()=>{var a;return`/api/rents?filter[client_id]=${(a=e.value.client)==null?void 0:a.id}`}),r=w(!1),_={expense:"/properties/:rent_id/transactions/expense",fee:"/properties/:rent_id/transactions/fee"};function N(){var l,g;if(!e.value.amount){D({type:"error",message:"should specify an amount"});return}const a={date:K(e.value.date||new Date,"yyyy-MM-dd"),amount:e.value.amount,concept:e.value.concept,account_id:e.value.account_id,client_id:((l=e.value.client)==null?void 0:l.id)??s.clientId,rent_id:((g=e.value.rent)==null?void 0:g.id)??s.rentId,details:e.value.notes};r.value=!0;const m=(_[s.type]??_.expense).replace(":rent_id",a.rent_id);axios.post(m,a).then(()=>{E(!0),v("saved")}).catch(C=>{D({type:"error",message:C.response?C.response.data.status.message:"Ha ocurrido un error"})}).finally(()=>{r.value=!1})}function E(a){e.value={...y,concept:s.defaultConcept},a&&V(!1)}function V(a){v("update:modelValue",a)}return(a,t)=>{const m=S;return h(),O(u(P),{onOpen:t[9]||(t[9]=l=>b()),"model-value":i.modelValue,class:"overflow-hidden","onUpdate:modelValue":t[10]||(t[10]=l=>a.$emit("update:modelValue",l))},{header:n(()=>[d("header",Q,[d("h4",W,M(i.title??i.defaultConcept),1),d("button",{class:"hover:text-danger",onClick:t[0]||(t[0]=l=>a.close())},[o(m)])])]),footer:n(()=>[d("div",te,[o(u(G),{disabled:r.value,onClick:t[7]||(t[7]=l=>V(!1)),class:"bg-white border rounded-md text-gray"},{default:n(()=>[f(" Cancel ")]),_:1},8,["disabled"]),o(R,{processing:r.value,disabled:r.value,variant:"secondary",onClick:t[8]||(t[8]=l=>N())},{default:n(()=>[f(" Guardar ")]),_:1},8,["processing","disabled"])])]),default:n(()=>[d("div",X,[d("section",Y,[o(u(L),{class:"w-full text-left",label:"Concepto"},{default:n(()=>[o(u($),{type:"text",class:"form-control",name:"invoice-description",id:"invoice-description",modelValue:e.value.concept,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.concept=l),rounded:""},null,8,["modelValue"])]),_:1})]),d("section",null,[d("section",Z,[o(c,{label:"Fecha limite",class:"w-6/12"},{default:n(()=>[o(u(T),{modelValue:e.value.date,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.date=l),size:"large",class:"w-full",rounded:""},null,8,["modelValue"])]),_:1}),o(c,{class:"w-6/12 text-left",label:"Monto Recibido"},{default:n(()=>[o(u($),{class:"form-control","number-format":"",modelValue:e.value.amount,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.amount=l),rounded:"",required:""},null,8,["modelValue"]),f(" "+M(u(B)),1)]),_:1})])]),i.hideClientOptions?H("",!0):(h(),j("section",ee,[o(c,{label:"Cliente"},{default:n(()=>[o(U,{modelValue:e.value.client,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.client=l),endpoint:"/api/clients",placeholder:"Selecciona cliente",label:"display_name","track-by":"id"},null,8,["modelValue"])]),_:1}),o(c,{label:"Propiedad"},{default:n(()=>[o(U,{modelValue:e.value.rent,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.rent=l),endpoint:u(I),placeholder:"Selecciona el contrato",label:"date","track-by":"id"},null,8,["modelValue","endpoint"])]),_:1})])),o(c,{class:"w-full text-left",label:"Notes"},{default:n(()=>[q(d("textarea",{class:"w-full px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:border-gray-400","onUpdate:modelValue":t[6]||(t[6]=l=>e.value.notes=l),cols:"3",rows:"3"},null,512),[[A,e.value.notes]])]),_:1})])]),_:1},8,["model-value"])}}});export{me as _};
