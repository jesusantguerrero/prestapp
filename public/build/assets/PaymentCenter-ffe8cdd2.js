import{z as T,l as N,k as S,P as M,r as w,c as h,w as s,C as D,o as y,b as l,a as c,u as m,t as g,g as k,f as j,h as $,E as C,R as z,H as G}from"./app-b9464164.js";import{V as H}from"./atmosphere-ui-8913659c.js";import{_ as P}from"./BaseSelect.vue_vue_type_script_setup_true_lang-89ccd5ed.js";/* empty css                                                   */import{_ as I}from"./BaseTable.vue_vue_type_style_index_0_lang-d3c40c15.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-0afa9cc5.js";import"./AppLayout.vue_vue_type_style_index_0_lang-0d2503f0.js";import O from"./LoanSectionNav-102d6475.js";import{_ as E}from"./AppButton.vue_vue_type_script_setup_true_lang-89aa5f09.js";import{a as U}from"./ClientForm.vue_vue_type_script_setup_true_lang-d4d45920.js";import"./clientInteractions-6c951eed.js";import{_ as B}from"./ButtonGroup.vue_vue_type_script_setup_true_lang-648d9fbe.js";import{f as F}from"./formatMoney-b7ef7683.js";import"./customCell-57b73ca8.js";import"./AppSearch.vue_vue_type_script_setup_true_lang-b788b25f.js";import"./close-45140fa9.js";import"./AppSearchFilters-93f60e1e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./PaymentFormModal.vue_vue_type_script_setup_true_lang-a1e2938d.js";import"./PaymentGrid-88a06cd9.js";/* empty css                                                                    */import"./mathHelper-44355b55.js";import"./exact-math.node-e9867222.js";import"./constants-0a903a05.js";import"./AccountSelect.vue_vue_type_script_setup_true_lang-d3f16147.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";import"./Modal.vue_vue_type_script_setup_true_lang-74361783.js";import"./usePaymentModal-23c75da0.js";import"./ClientFormModal.vue_vue_type_script_setup_true_lang-3f2645eb.js";import"./menus-2c7b33a0.js";import"./SectionNav.vue_vue_type_script_setup_true_lang-b284cd8c.js";const R=o=>o.reduce((r,t)=>(r[(t==null?void 0:t.name)??t]=null,r),{}),q=(o,r)=>Object.entries(o).reduce((t,[n,i])=>(i&&(t[n]=i[r]),t),{}),A=(o,r,t="id")=>{const n=T(R(o));return N(()=>n,i=>{const f=q(i,t);console.log(f,i),r.get(location.pathname,{filters:f},{preserveState:!0})},{deep:!0}),n},K={class:"py-10 mx-auto md-24 md:mt-0 sm:px-6 lg:px-8"},L={class:"flex space-x-4 w-full px-4 rounded-md bg-base-lvl-3"},Q={class:"rounded-md bg-base-lvl-3 mt-4"},W={class:"px-4 pb-10"},X=["onClick"],Y={key:0,class:"w-full text-right px-4 md:px-0 space-x-4 pb-4"},Ne=S({__name:"PaymentCenter",props:{invoices:null,loans:null,clients:null,currentTab:null},setup(o){const r=o,t=M({client:null,account:null,payments:[]}),n=A(["client","loan"],C),i=(p,a)=>{a.payment=a.amount_due},f=()=>{var e,b,x;const p=(e=payments.value)==null?void 0:e.reduce((_,d)=>(d.amount&&_.push({id:d.id,rent_id:d.rent_id,amount:d.payment,original_amount:d.amount}),_),[]);if(!p.length){z({type:"error",message:"Seleccione al menos un pago",title:"Error de pago"});return}const a=p[0].rent_id,v={client_id:(b=t.client)==null?void 0:b.id,account_id:(x=t.account)==null?void 0:x.id,rent_id:a,payments:p,total:p.reduce((_,d)=>_+parseFloat(d.amount),0)};G.post(`/properties/${a}/transactions/refund`,v).then(({data:_})=>{console.log(_)})},V={pending:{label:"Pendientes"},all:{label:"Todos"},payments:{label:"Pagos"}},u=w(r.currentTab);return N(u,()=>{C.reload({data:{tab:u.value}})}),(p,a)=>{const v=D("ElCheckbox");return y(),h(J,{title:"Centro de pago de prestamos"},{header:s(()=>[l(O,null,{actions:s(()=>[l(B,{values:V,modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),class:"hidden md:flex"},null,8,["modelValue"])]),_:1})]),default:s(()=>[c("main",K,[l(B,{values:V,modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e),class:"w-full mt-4 md:hidden"},null,8,["modelValue"]),c("header",L,[l(U,{label:"Cliente",class:"w-full"},{default:s(()=>[l(P,{modelValue:m(n).client,"onUpdate:modelValue":a[2]||(a[2]=e=>m(n).client=e),options:o.clients,placeholder:"selecciona un cliente",label:"display_name","track-by":"id"},null,8,["modelValue","options"])]),_:1}),l(U,{label:"Categoria",class:"w-full"},{default:s(()=>[l(P,{modelValue:m(n).loan,"onUpdate:modelValue":a[3]||(a[3]=e=>m(n).loan=e),"track-by":"id",options:o.loans,"hide-selected":!1,"custom-label":e=>`Prestamo ${e.id} (${e.amount}) (debt: $${e.debt})`,placeholder:"selecciona una categoria"},null,8,["modelValue","options","custom-label"])]),_:1})]),c("section",Q,[c("article",W,[l(I,{cols:[{name:"loan_id",label:"Prestamo #"},{name:"client.display_name",label:"Cliente"},{name:"amount",label:"Monto del pagare",render(e){return m(F)(e.amount)}},{name:"amount_paid",label:"Balance",render(e){return m(F)(e.amount_due)}},{name:"payment",label:"Monto de reembolso"}],"table-data":o.invoices.data},{loan_id:s(({scope:{row:e}})=>[c("div",{class:"items-center space-x-2 flex cursor-pointer",onClick:b=>i(!e.amount,e)},[l(v,{"model-value":!!e.payment},null,8,["model-value"]),c("span",null," Prestamo #"+g(e.loan_id),1)],8,X)]),payment:s(({scope:{row:e}})=>[e.amount_due>0?(y(),h(m(H),{key:0,class:"rounded-md shadow-none border-body-1/10",modelValue:e.payment,"onUpdate:modelValue":b=>e.payment=b,"number-format":!0},null,8,["modelValue","onUpdate:modelValue"])):k("",!0),c("span",null,g(e.amount_due),1)]),_:1},8,["cols","table-data"])]),u.value=="pending"&&m(n).client?(y(),j("footer",Y,[l(E,{variant:"neutral"},{default:s(()=>[$(" Cancelar")]),_:1}),l(E,{variant:"secondary",onClick:f},{default:s(()=>[$(" Guardar y Pagar")]),_:1})])):k("",!0)])])]),_:1})}}});export{Ne as default};
