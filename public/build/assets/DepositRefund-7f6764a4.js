import{k as D,P as E,r as h,l as g,d as M,c as N,w as s,C as U,o as P,b as n,a as r,u as i,t as S,h as y,H as u,R as T}from"./app-b9464164.js";import{R as x,V as F}from"./atmosphere-ui-8913659c.js";import{_ as V}from"./BaseSelect.vue_vue_type_script_setup_true_lang-89ccd5ed.js";/* empty css                                                   */import{_ as G}from"./BaseTable.vue_vue_type_style_index_0_lang-d3c40c15.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-0afa9cc5.js";import"./AppLayout.vue_vue_type_style_index_0_lang-0d2503f0.js";import{_ as I}from"./PropertySectionNav.vue_vue_type_script_setup_true_lang-e2241f15.js";import{_ as C}from"./AppButton.vue_vue_type_script_setup_true_lang-89aa5f09.js";import"./customCell-57b73ca8.js";import"./AppSearch.vue_vue_type_script_setup_true_lang-b788b25f.js";import"./close-45140fa9.js";import"./AppSearchFilters-93f60e1e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./PaymentFormModal.vue_vue_type_script_setup_true_lang-a1e2938d.js";import"./PaymentGrid-88a06cd9.js";/* empty css                                                                    */import"./mathHelper-44355b55.js";import"./exact-math.node-e9867222.js";import"./constants-0a903a05.js";import"./AccountSelect.vue_vue_type_script_setup_true_lang-d3f16147.js";import"./formatMoney-b7ef7683.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";import"./Modal.vue_vue_type_script_setup_true_lang-74361783.js";import"./usePaymentModal-23c75da0.js";import"./ClientFormModal.vue_vue_type_script_setup_true_lang-3f2645eb.js";import"./ClientForm.vue_vue_type_script_setup_true_lang-d4d45920.js";import"./clientInteractions-6c951eed.js";import"./SectionNav.vue_vue_type_script_setup_true_lang-b284cd8c.js";import"./menus-2c7b33a0.js";const j={class:"py-10 mx-auto sm:px-6 lg:px-8"},q={class:"rounded-md bg-base-lvl-3"},z={class:"flex space-x-4 w-full px-4"},A={class:"px-4 pb-10"},J={class:"items-center space-x-2 d-flex"},K={class:"w-full text-right space-x-4 pb-4"},$e=D({__name:"DepositRefund",props:{category:null},setup(v){const $=v,t=E({client:null,account:null,payments:[]}),d=h([]);g(()=>t.client,async()=>{d.value=await k(t.client.id,$.category),t.account=d.value.length?d.value[0]:null});function k(o,a){return u.get(`/categories/${a}/clients/${o}/balance?exclude_credits=true`).then(({data:l})=>l)}const _=h([]),b=M(()=>_.value.reduce((o,a)=>(console.log(a),a!=null&&a.transactionable&&o.push(...a.transactionable.payments.map(l=>({...l,rent_id:a.transactionable.invoiceable_id,client:t.client,balance:t.account.balance,payment:0}))),o),[])),w=(o,a)=>u.get("/api/transaction-lines",{params:{limit:10,page:1,filter:{account_id:a,payee_id:o},relationships:"transaction.transactionable.payments"}}).then(({data:l})=>l.data.map(e=>e.transaction));g(()=>t.account,async()=>{_.value=await w(t.client.id,t.account.id)});const B=()=>{},R=()=>{var e,m,f;const o=(e=b.value)==null?void 0:e.reduce((p,c)=>(c.amount&&p.push({id:c.id,rent_id:c.rent_id,amount:c.payment,original_amount:c.amount}),p),[]);if(!o.length){T({type:"error",message:"Seleccione al menos un pago",title:"Error de pago"});return}const a=o[0].rent_id,l={client_id:(m=t.client)==null?void 0:m.id,account_id:(f=t.account)==null?void 0:f.id,rent_id:a,payments:o,total:o.reduce((p,c)=>p+parseFloat(c.amount),0)};u.post(`/properties/${a}/transactions/refund`,l).then(({data:p})=>{console.log(p)})};return(o,a)=>{const l=U("ElCheckbox");return P(),N(H,{title:"Rembolso de depositos"},{header:s(()=>[n(I)]),default:s(()=>[r("main",j,[r("section",q,[r("header",z,[n(i(x),{label:"Cliente",class:"w-full"},{default:s(()=>[n(V,{modelValue:i(t).client,"onUpdate:modelValue":a[0]||(a[0]=e=>i(t).client=e),endpoint:"/api/clients",placeholder:"selecciona un cliente",label:"display_name","track-by":"id"},null,8,["modelValue"])]),_:1}),n(i(x),{label:"Categoria",class:"w-full"},{default:s(()=>[n(V,{modelValue:i(t).account,"onUpdate:modelValue":a[1]||(a[1]=e=>i(t).account=e),"track-by":o.id,options:d.value,"hide-selected":!1,"custom-label":e=>`${e.name} (Balance: $${Math.abs(e.balance)})`,placeholder:"selecciona una categoria"},null,8,["modelValue","track-by","options","custom-label"])]),_:1})]),r("article",A,[n(G,{cols:[{name:"item",label:""},{name:"id",label:"Pago #"},{name:"client.display_name",label:"Cliente"},{name:"method_name",label:"Metodo de pago"},{name:"balance",label:"Balance",render(e){return Math.abs(e.balance)}},{name:"payment",label:"Monto de reembolso"}],"table-data":i(b)},{item:s(({scope:{row:e}})=>[r("div",J,[n(l,{onChange:m=>B(m,e)},null,8,["onChange"]),r("span",null,S(e.name),1)])]),payment:s(({scope:{row:e}})=>[n(i(F),{class:"rounded-md shadow-none border-body-1/10",modelValue:e.payment,"onUpdate:modelValue":m=>e.payment=m,"number-format":!0},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["cols","table-data"])]),r("footer",K,[n(C,null,{default:s(()=>[y(" Cancel")]),_:1}),n(C,{onClick:R},{default:s(()=>[y(" Guardar y Pagar")]),_:1})])])])]),_:1})}}});export{$e as default};
