import{k as S,r as h,l as m,d as _,c,w as d,u as l,a2 as F,A as q,o as p,a as u,b as n,h as i,a3 as B,t as R,e as E,W as H,R as O}from"./app-de9d56f0.js";import{N as P,V as w,R as f}from"./atmosphere-ui-55a1c253.js";import{_ as C}from"./AppButton.vue_vue_type_script_setup_true_lang-81087974.js";import{_ as k}from"./BaseSelect.vue_vue_type_script_setup_true_lang-7415b2b5.js";/* empty css                                                   */import{M as T}from"./mathHelper-c551ea9f.js";import{p as D}from"./constants-0a903a05.js";import{f as j}from"./index-c251e33c.js";const A={class:"flex space-x-4"},z={class:"flex"},G={class:"mt-4 flex space-x-4"},I={class:"w-full text-left"},W=u("label",{for:""},"Notes",-1),J={class:"space-x-2 dialog-footer"},ae=S({__name:"InvoiceFormModal",props:{modelValue:Boolean,defaultConcept:{type:String,required:!0},defaultAmount:{type:Number,required:!0},payment:[Object,null],due:Number,endpoint:{type:String,required:!0},title:{type:String,default:"Crear factura"}},emits:["update:modelValue","saved"],setup(v,{emit:r}){const s=v,y={amount:0,account_id:""};q("accountsOptions",[]);const e=h(b()),V=()=>{e.value=b()};function b(){return{...y,concept:s.defaultConcept,amount:s.due??0,payment_method_id:D[0].id,paymentMethod:D[0],date:new Date}}m(()=>s.defaultConcept,a=>{e.value.concept=a},{immediate:!0}),m(()=>s.due,a=>{e.value.id||(e.value.amount=a)},{immediate:!0}),m(s.payment,a=>{a&&V()},{deep:!0,immediate:!0});const $=_(()=>{var a;return(a=e.value.documents)==null?void 0:a.reduce((t,o)=>T.sum(t,o.payment),0)}),M=_(()=>{var a;return`/api/rents?filter[client_id]=${(a=e.value.client)==null?void 0:a.id}`});function N(){if(!e.value.amount){notify({type:"error",message:"should specify an amount"});return}const a={date:j(e.value.date||new Date,"yyyy-MM-dd"),amount:e.value.amount,concept:e.value.concept,account_id:e.value.account_id,client_id:e.value.client.id,rent_id:e.value.rent.id,details:e.value.notes};axios.post(`properties/${a.rent_id}/transactions/expense`,a).then(()=>{x(!0),r("saved")}).catch(t=>{O({type:"error",message:t.response?t.response.data.status.message:"Ha ocurrido un error"})})}function U(){axios.delete(`${s.endpoint}/${e.id}`).then(()=>{r("update:modelValue",!1),r("saved"),x(!0)}).catch(a=>{notify({type:"error",message:a.response?a.response.data.status.message:"Ha ocurrido un error"})})}function x(a){e.value={...y,concept:s.defaultConcept},a&&g(!1)}function g(a){r("update:modelValue",a)}return(a,t)=>(p(),c(l(F),{title:"Crear factura",onOpen:t[9]||(t[9]=o=>V()),"model-value":v.modelValue,"onUpdate:modelValue":t[10]||(t[10]=o=>a.$emit("update:modelValue",o))},{footer:d(()=>[u("div",J,[n(l(P),{onClick:t[6]||(t[6]=o=>g(!1)),class:"bg-white border rounded-md text-gray"},{default:d(()=>[i(" Cancel ")]),_:1}),e.value.id?(p(),c(C,{key:0,class:"text-white bg-blue-500",onClick:t[7]||(t[7]=o=>U())},{default:d(()=>[i(" Delete ")]),_:1})):(p(),c(C,{key:1,variant:"secondary",onClick:t[8]||(t[8]=o=>N())},{default:d(()=>[i(" Guardar ")]),_:1}))])]),default:d(()=>[u("div",null,[u("section",A,[n(l(f),{class:"w-full text-left",label:"Concepto"},{default:d(()=>[n(l(w),{type:"text",class:"form-control",name:"invoice-description",id:"invoice-description",modelValue:e.value.concept,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.concept=o),rounded:""},null,8,["modelValue"])]),_:1})]),u("section",null,[u("section",z,[n(l(f),{label:"Fecha limite",class:"w-6/12"},{default:d(()=>[n(l(B),{modelValue:e.value.date,"onUpdate:modelValue":t[1]||(t[1]=o=>e.value.date=o),size:"large",class:"w-full",rounded:""},null,8,["modelValue"])]),_:1}),n(l(f),{class:"w-6/12 text-left",label:"Monto Recibido"},{default:d(()=>[n(l(w),{class:"form-control","number-format":"",modelValue:e.value.amount,"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.amount=o),rounded:"",required:""},null,8,["modelValue"]),i(" "+R(l($)),1)]),_:1})])]),u("section",G,[n(k,{modelValue:e.value.client,"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.client=o),endpoint:"/api/clients",placeholder:"Selecciona cliente",label:"display_name","track-by":"id"},null,8,["modelValue"]),n(k,{modelValue:e.value.rent,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.rent=o),endpoint:l(M),placeholder:"Selecciona el contrato",label:"date","track-by":"id"},null,8,["modelValue","endpoint"])]),u("div",I,[W,E(u("textarea",{class:"w-full px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:border-gray-400","onUpdate:modelValue":t[5]||(t[5]=o=>e.value.notes=o),cols:"3",rows:"3"},null,512),[[H,e.value.notes]])])])]),_:1},8,["model-value"]))}});export{ae as _};
