import{l as T,z as B,m as E,ag as M,d as g,r as k,c as h,w as s,u as n,C as P,o as y,b as l,h as b,t as I,a as r,g as w,f as L,N as O,E as j}from"./app-e7293397.js";import{z as c,s as R,k as S,F as G}from"./atmosphere-ui-86b7f8ed.js";import{_ as H}from"./AppLayout.vue_vue_type_style_index_0_lang-96d4f03f.js";import{_ as q}from"./AppButton.vue_vue_type_script_setup_true_lang-046c4e1c.js";import{_ as J}from"./InstallmentTable.vue_vue_type_script_setup_true_lang-cbcb4ed7.js";import{_ as Y}from"./LoanSectionNav.vue_vue_type_script_setup_true_lang-6869f5ef.js";import{s as K}from"./createLoan-95aa21fa.js";import{g as Q,a as W}from"./generateInstallments-d1542e70.js";import{l as X}from"./constants-0a903a05.js";import{f as V}from"./index-9dc2d84c.js";import{_ as Z}from"./BaseSelect.vue_vue_type_style_index_1_lang-cbd59430.js";import{_ as x}from"./FormSection.vue_vue_type_script_setup_true_lang-bb2801db.js";import{_ as ee}from"./LoanSummary.vue_vue_type_script_setup_true_lang-bea8f4d9.js";import{_ as te}from"./AccountSelect.vue_vue_type_script_setup_true_lang-cb870c82.js";import{_ as d}from"./AppFormField.vue_vue_type_style_index_0_lang-d6998fd8.js";import{a as le}from"./index-17a9d477.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./PaymentFormModal.vue_vue_type_script_setup_true_lang-dd64f8b8.js";import"./close-f1b40d6b.js";import"./PaymentGrid-6607ced0.js";import"./mathHelper-95aa3a2b.js";import"./exact-math.node-9a256fc0.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";import"./Modal.vue_vue_type_script_setup_true_lang-53b90f8d.js";import"./InvoiceFormModal.vue_vue_type_script_setup_true_lang-88bfc502.js";import"./user-outline-dcfa7b13.js";import"./ClientFormModal.vue_vue_type_script_setup_true_lang-d0093e27.js";import"./ClientForm.vue_vue_type_script_setup_true_lang-f1abe81a.js";import"./SectionNav.vue_vue_type_script_setup_true_lang-e0dfad64.js";import"./constants-22f9a1fe.js";import"./usePaymentModal-ad844d5c.js";import"./FastAccessOptions.vue_vue_type_script_setup_true_lang-1fc13d45.js";import"./sharp-payment-a1c72b2d.js";import"./BaseTable.vue_vue_type_style_index_0_lang-efd97e4a.js";import"./customCell-f0a6687f.js";import"./IconMarker-562faee5.js";import"./formatMoney-b7ef7683.js";import"./menus-f4817d1f.js";import"./index-3624ec38.js";import"./IconCoins-68b11b4b.js";const ae={class:"flex flex-col md:flex-row w-full pb-10 mt-24 md:mt-16 md:space-x-4"},se={class:"w-full md:w-8/12 p-4 bg-white rounded-md shadow-md text-body-1"},oe={class:"flex flex-col md:flex-row md:space-x-4"},ne=r("div",null,null,-1),re={class:"flex flex-col md:flex-row md:space-x-4"},de={class:"flex flex-col md:flex-row w-full md:space-x-4"},ie={class:"flex space-x-4"},ue={class:"flex space-x-4"},me={class:"w-full md:w-4/12 mt-4 md:mt-0 rounded-md bg-white shadow-md relative overflow-hidden grid gap-4 grid-cols-1 grid-rows-[1fr_50px]"},ce={class:"w-full px-4 overflow-hidden text-body-1"},fe=r("header",{class:"py-4 font-bold"},"Resumen de prestamo",-1),pe={key:0,class:"mt-4"},_e=r("h4",{class:"text-xl font-bold"},"Tabla de amortización",-1),ye={class:"flex justify-between w-full px-4 py-1"},st=T({__name:"EditForm",props:{loans:null,clients:null},setup(z){const m=z,e=B({id:null,client_id:null,client:void 0,amount:0,repayment_count:0,interest_rate:0,frequency:"MONTHLY",disbursement_date:new Date,first_repayment_date:le(new Date,1),grace_days:0,late_fee:0,installments_paid:0,closing_fees:0,category_id:null,source_type:null,source_account_id:null,sourceAccount:null});E(()=>m.loans,o=>{var t;o&&(Object.keys(e).forEach(i=>{e[i]=o[i]||e[i]}),e.client_id=((t=m.loans.client)==null?void 0:t.id)??1,e.client=m.loans.client)},{immediate:!0,deep:!0}),M(()=>{e.disbursement_date&&e.frequency&&O(()=>{e.first_repayment_date=Q(e.disbursement_date,e.frequency,!1)})});const N=g(()=>{var o,t;return(o=m.loans)!=null&&o.id?`Prestamo ${(t=m.loans.client)==null?void 0:t.fullName}`:"Crear Prestamo"}),A=g(()=>{var o;return(o=m.loans)!=null&&o.id?"Guardar prestamo":"Registrar Prestamo"}),u=k(null);M(()=>{const o=V(e.first_repayment_date,"yyyy-MM-dd");e.amount&&e.repayment_count&&(u.value=W({interest_rate:e.interest_rate,amount:e.amount,repayment_count:e.repayment_count,first_repayment_date:o,frequency:e.frequency}))});const v=g(()=>{var o,t;return u.value&&((t=(o=u.value)==null?void 0:o.payments)==null?void 0:t.length)}),p=k(!1),C=()=>{var t,i;const o={...e,date:V(e.disbursement_date,"yyyy-MM-dd"),disbursement_date:V(e.disbursement_date,"yyyy-MM-dd"),first_repayment_date:V(e.first_repayment_date,"y-M-d"),client_id:e.client.id,source_type:(t=e.sourceType)==null?void 0:t.id,source_account_id:(i=e.sourceAccount)==null?void 0:i.id};p.value=!0,K(o,u.value.payments).then(()=>{close(),$()}).catch(f=>{console.log(f)}).finally(()=>{p.value=!1})},_=k(!0),$=()=>{j.visit("/loans")};return(o,t)=>{const i=P("ElDatePicker");return y(),h(H,{title:n(N)},{header:s(()=>[l(Y,null,{actions:s(()=>[l(q,{variant:"secondary",class:"hidden md:flex",onClick:t[0]||(t[0]=f=>C()),disabled:!n(v)},{default:s(()=>[b(I(n(A)),1)]),_:1},8,["disabled"])]),_:1})]),default:s(()=>{var f,U,D,F;return[r("main",ae,[r("section",se,[l(x,{title:"Datos del cliente",class:"w-full","section-class":"w-full"},{default:s(()=>[l(d,{label:"Cliente",class:"w-full",required:""},{default:s(()=>[l(Z,{modelValue:e.client,"onUpdate:modelValue":t[1]||(t[1]=a=>e.client=a),"track-by":"id",endpoint:"/api/clients",placeholder:"Selecciona un cliente",label:"display_name",class:"w-full",required:""},null,8,["modelValue"])]),_:1})]),_:1}),l(x,{title:"Terminos de prestamo","section-class":"w-full"},{default:s(()=>[r("section",oe,[l(d,{label:"Monto a prestar",class:"w-full",required:""},{default:s(()=>[l(n(c),{modelValue:e.amount,"onUpdate:modelValue":t[2]||(t[2]=a=>e.amount=a),"number-format":"",rounded:""},null,8,["modelValue"])]),_:1}),l(d,{label:"Interés mensual",class:"w-full",required:""},{default:s(()=>[l(n(c),{modelValue:e.interest_rate,"onUpdate:modelValue":t[3]||(t[3]=a=>e.interest_rate=a),"number-format":"",max:"100",rounded:""},{suffix:s(()=>[ne]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"Cuotas",class:"w-full",required:""},{default:s(()=>[l(n(c),{modelValue:e.repayment_count,"onUpdate:modelValue":t[4]||(t[4]=a=>e.repayment_count=a),rounded:""},null,8,["modelValue"])]),_:1})]),r("section",re,[l(d,{label:"Fecha de desembolso",required:""},{default:s(()=>[l(i,{modelValue:e.disbursement_date,"onUpdate:modelValue":t[5]||(t[5]=a=>e.disbursement_date=a),size:"large",class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"Fecha de primer pago",required:""},{default:s(()=>[l(i,{modelValue:e.first_repayment_date,"onUpdate:modelValue":t[6]||(t[6]=a=>e.first_repayment_date=a),size:"large",class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"Frecuencia",class:"w-full",required:""},{default:s(()=>[l(n(R),{options:n(X),modelValue:e.frequency,"onUpdate:modelValue":t[7]||(t[7]=a=>e.frequency=a)},null,8,["options","modelValue"])]),_:1})])]),_:1}),l(q,{class:"w-full justify-center text-center",onClick:t[8]||(t[8]=a=>_.value=!_.value)},{default:s(()=>[b(" Opciones Avanzadas")]),_:1}),_.value?(y(),h(x,{key:0,title:"Avanzadas","section-class":"w-full",class:"mt-4"},{default:s(()=>[r("section",de,[l(d,{label:"Dias de gracia",class:"w-full"},{default:s(()=>[l(n(c),{modelValue:e.grace_days,"onUpdate:modelValue":t[9]||(t[9]=a=>e.grace_days=a),rounded:""},null,8,["modelValue"])]),_:1}),l(d,{label:"Interes de mora",class:"w-full"},{default:s(()=>[l(n(c),{modelValue:e.late_fee,"onUpdate:modelValue":t[10]||(t[10]=a=>e.late_fee=a),rounded:""},null,8,["modelValue"])]),_:1}),w("",!0)]),r("section",ie,[l(d,{label:"Gastos de cierre",class:"w-full"},{default:s(()=>[l(n(c),{modelValue:e.closing_fees,"onUpdate:modelValue":t[12]||(t[12]=a=>e.closing_fees=a),rounded:""},null,8,["modelValue"])]),_:1}),l(n(S),{class:"w-full hidden"})])]),_:1})):w("",!0),_.value?(y(),h(x,{key:1,title:"Contabilidad","section-class":"w-full",class:"mt-4"},{default:s(()=>[r("section",ue,[l(d,{label:"Cuenta origen",field:"sourceAccount",class:"w-full",required:""},{default:s(()=>[l(te,{modelValue:e.sourceAccount,"onUpdate:modelValue":t[13]||(t[13]=a=>e.sourceAccount=a)},null,8,["modelValue"])]),_:1})])]),_:1})):w("",!0)]),r("article",me,[r("section",ce,[fe,l(ee,{payment:(f=u.value)==null?void 0:f.payment,"total-interest":(U=u.value)==null?void 0:U.totalInterest,"total-debt":(D=u.value)==null?void 0:D.totalDebt},null,8,["payment","total-interest","total-debt"]),n(v)?(y(),L("section",pe,[_e,l(J,{installments:(F=u.value)==null?void 0:F.payments,"hidden-cols":["loan_id","actions"]},null,8,["installments"])])):w("",!0)]),r("footer",ye,[l(n(G),{class:"font-bold text-red-400 rounded-md bg-base-lvl-2",variant:"secondary",onClick:t[14]||(t[14]=a=>$())},{default:s(()=>[b(" Cancelar ")]),_:1}),l(q,{processing:p.value,variant:"secondary",onClick:C,disabled:!n(v)||p.value},{default:s(()=>[b(" Registar Prestamo ")]),_:1},8,["processing","disabled"])])])])]}),_:1},8,["title"])}}});export{st as default};
