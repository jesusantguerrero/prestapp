import{_ as j}from"./bank-minus-ed476f28.js";import{t as h}from"./atmosphere-ui-86b7f8ed.js";import{l as A,z,m as L,P as T,d as N,c as S,w as c,o as f,b as s,a as l,u as r,f as g,F as C,j as G,h as b,t as _,y as D,E as J,M as $,W as U,Y as W}from"./app-e7293397.js";import{_ as Y}from"./BaseSelect.vue_vue_type_style_index_1_lang-cbd59430.js";import{_ as q}from"./AppLayout.vue_vue_type_style_index_0_lang-96d4f03f.js";import{_ as H}from"./PropertySectionNav.vue_vue_type_script_setup_true_lang-516e104c.js";import{f as K}from"./index-9dc2d84c.js";import{_ as Q}from"./BaseTable.vue_vue_type_style_index_0_lang-efd97e4a.js";import{_ as k}from"./AppButton.vue_vue_type_script_setup_true_lang-046c4e1c.js";import{a as R}from"./user-outline-dcfa7b13.js";import{_ as X}from"./AppFormField.vue_vue_type_style_index_0_lang-d6998fd8.js";import{f as y}from"./formatMoney-b7ef7683.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import"./PaymentFormModal.vue_vue_type_script_setup_true_lang-dd64f8b8.js";import"./close-f1b40d6b.js";import"./PaymentGrid-6607ced0.js";import"./mathHelper-95aa3a2b.js";import"./exact-math.node-9a256fc0.js";import"./constants-0a903a05.js";import"./AccountSelect.vue_vue_type_script_setup_true_lang-cb870c82.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";import"./Modal.vue_vue_type_script_setup_true_lang-53b90f8d.js";import"./InvoiceFormModal.vue_vue_type_script_setup_true_lang-88bfc502.js";import"./ClientFormModal.vue_vue_type_script_setup_true_lang-d0093e27.js";import"./ClientForm.vue_vue_type_script_setup_true_lang-f1abe81a.js";import"./SectionNav.vue_vue_type_script_setup_true_lang-e0dfad64.js";import"./constants-22f9a1fe.js";import"./usePaymentModal-ad844d5c.js";import"./FastAccessOptions.vue_vue_type_script_setup_true_lang-1fc13d45.js";import"./menus-f4817d1f.js";import"./index-3624ec38.js";import"./customCell-f0a6687f.js";const ee=i=>(U("data-v-10047e8b"),i=i(),W(),i),te={class:"py-10 mx-auto sm:px-6 lg:px-8"},ae={class:"flex space-x-4"},re={class:"mt-4 bg-base-lvl-3 rounded-md overflow-hidden py-3 px-5"},oe={class:"font-bold text-gray-300"},se=ee(()=>l("i",{class:"fa fa-user text-xs"},null,-1)),ie={class:"flex justify-end px-4 py-2 space-x-2"},ne={key:1,class:"h-48 flex items-center justify-center"},le=A({__name:"OwnerDraws",props:{invoices:{type:Array},properties:{type:Array,default(){return[]}},owners:{type:Array,default(){return[]}},outstanding:{type:Number},paid:{type:Number},lateDays:{type:Number}},setup(i){const n=z({owner:null,property:null});L(()=>n,()=>{const e=Object.entries(n).reduce((t,[m,o])=>(t[m]=o==null?void 0:o.id,t),{});J.get(location.pathname,{filters:e},{preserveState:!0})},{deep:!0});const I=e=>{const{columns:t,data:m}=e,o=[];return t.forEach((d,a)=>{if(a===1){o[a]="Monto a pagar desde cuenta de immobiliaria";return}const v=m.map(u=>Number(u[d.property]));if(v.every(u=>Number.isNaN(u)))o[a]="";else{const u=v.reduce((w,x)=>{const E=Number(x);return Number.isNaN(E)?w:w+x},0);o[a]=y(u)}}),o},M=[{name:"description",label:"Descripcion / Cliente",width:400},{name:"due_date",label:"Fecha",align:"center",class:"text-center",width:120,render(e){return K(e.due_date)}},{name:"property_name",label:"Propiedad"},{name:"total",label:"Disponible para pago",render(e){return y(e.total)}}],p=T({client:null,invoices:[]});function B(e){p.invoices=e.map(t=>({id:t.id,total:t.total}))}function F(){var e,t;if(!((e=n.owner)!=null&&e.id)){$({title:"Sin Propietario",message:"Por favor seleccione el propietario para generar la factura",type:"error"});return}p.post(`/owners/${(t=n.owner)==null?void 0:t.id}/draws`,{onSuccess(){$({title:"Creada",message:"Factura de propiedad creada con exito",type:"success"})}})}const{openModal:O}=R("invoice"),P=N(()=>n.owner?"No hay facturas para pagar al propietario":"Seleccione propietario para ver sus facturas"),V=N(()=>{var e;return((e=n.owner)==null?void 0:e.id)&&!p.processing&&p.invoices.length});return(e,t)=>{const m=j;return f(),S(q,{title:"Centro de pago"},{header:c(()=>[s(H)]),default:c(()=>{var o;return[l("div",te,[l("section",ae,[s(r(h),{class:"w-full bg-white border h-28 text-body-1",title:"Pagado",value:r(y)(i.paid??0)},null,8,["value"]),s(r(h),{class:"w-full bg-white border h-28 text-body-1",title:"Balance de Pendiente",value:r(y)(i.outstanding??0)},null,8,["value"]),s(r(h),{class:"w-full bg-white border h-28 text-body-1",title:"Dias de mora",value:i.lateDays||0},null,8,["value"])]),l("div",re,[s(X,{label:"Propietario"},{default:c(()=>[s(Y,{modelValue:n.owner,"onUpdate:modelValue":t[0]||(t[0]=d=>n.owner=d),endpoint:"/api/clients?filter[is_owner]=1",placeholder:"Selecciona un propietario",label:"display_name","track-by":"id"},null,8,["modelValue"])]),_:1}),(o=i.invoices)!=null&&o.length&&n.owner?(f(),g(C,{key:0},[(f(!0),g(C,null,G(i.invoices,d=>(f(),S(Q,{class:"mt-0","table-class":"px-0","show-summary":"",selectable:"",onSelectionChange:B,"summary-method":I,cols:M,"table-data":d.invoices},{description:c(({scope:{row:a}})=>[l("section",null,[l("p",null,[s(r(D),{href:`/${a.type=="INVOICE"?"invoices":"bills"}/${a.id}`,class:"text-blue-400 capitalize border-b border-blue-400 border-dashed cursor-pointer text-sm"},{default:c(()=>[b(_(a.description)+" ",1),l("span",oe,_(a.series)+" #"+_(a.number),1)]),_:2},1032,["href"])]),l("p",null,[s(r(D),{class:"text-sm text-body-1 mt-2",href:`/clients/${a.client_id||a.contact_id}`},{default:c(()=>[se,b(" "+_(a.owner_name),1)]),_:2},1032,["href"])])])]),_:2},1032,["table-data"]))),256)),l("footer",ie,[s(k,{variant:"error",onClick:t[1]||(t[1]=d=>!r(p).processing&&r(O)({data:{},isOpen:!0})),disabled:r(p).processing},{default:c(()=>[s(m,{class:"mr-2"}),b(" Crear Gasto ")]),_:1},8,["disabled"]),s(k,{variant:"secondary",onClick:F,processing:r(p).processing,disabled:!r(V)},{default:c(()=>[b(" Crear Factura de distribucion ")]),_:1},8,["processing","disabled"])])],64)):(f(),g("p",ne,_(r(P)),1))])])]}),_:1})}}});const Ge=Z(le,[["__scopeId","data-v-10047e8b"]]);export{Ge as default};
