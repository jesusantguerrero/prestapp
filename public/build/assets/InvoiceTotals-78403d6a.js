import{z as j,d as h,l as q,B,f as u,a as t,t as c,u as e,F as $,j as F,g,s as I,o as d,m as O}from"./app-5778ba55.js";import{f as V}from"./index-8305cd09.js";import{e as k}from"./exact-math.node-d4a7cd04.js";import{f as p}from"./formatMoney-b7ef7683.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";const w={class:"invoice-totals"},A={class:"total-labels"},C=t("span",{class:"label"},"Subtotal: ",-1),E={class:"value"},M={class:"total-labels"},N={class:"label"},L={class:"value"},R={class:"total-labels"},z=t("span",{class:"label"},"Discount:",-1),P={class:"value"},G={class:"total-labels total-remark"},H=t("span",{class:"label"}," Total: ",-1),J={class:"value"},K={key:1},Q=["onClick"],U={class:"label"},W={class:"value"},X={class:"total-labels total-remark"},Y=t("span",{class:"label"}," Debt: ",-1),Z={class:"value"},rt={__name:"InvoiceTotals",props:{tableData:{type:Array,required:!0},subtotalField:{type:String,required:!0},discountField:{type:String,required:!0},payments:{type:Array},totalField:{type:String,required:!0},totalValues:{type:Object,required:!0},isTaxIncluded:{type:Boolean,default:!1}},emits:["edit-payment"],setup(m){const r=m,S=(a,s)=>k.formula(`(${a} / ((100 + ${s}) / 100))`),l=j({totals:h(()=>r.tableData.reduce((s,o)=>{const i=o[r.totalField];let f=0,_=0;return o.taxes.forEach(n=>{const T=`${n.label||n.name} ${n==null?void 0:n.rate}%`;if(T&&n.rate){const x=r.isTaxIncluded?S(i,n.rate):i,v=k.formula(`${x} * (${n.rate} / ${100})`)*(n.type??1);s.taxes[T]=(s.taxes[T]||0)+(v||0),s.taxesTotal+=v,f+=v,_+=x}}),_=_||i,s.subtotal+=_,s.discountTotal+=Number(o[r.discountField]),s.total+=k.add(_,f??0),s.taxesTotal+=f,s},{total:0,discountTotal:0,subtotal:0,taxesTotal:0,taxes:{}})),hasTaxes:h(()=>Object.keys(l.totals.taxes).length>0),paymentTotal:h(()=>r.payments&&r.payments.length?r.payments.reduce((a,s)=>a+=parseFloat(s.amount),0):0),debt:h(()=>l.totals.total-l.paymentTotal)});q(()=>l.totals,()=>{l.totals&&Object.keys(l.totals).length&&Object.keys(l.totals).forEach(a=>{r.totalValues[a]=l.totals[a]})},{deep:!0,immediate:!0});const{totals:b,debt:y,hasTaxes:D,paymentTotal:tt}=B(l);return(a,s)=>(d(),u("div",w,[t("p",A,[C,t("span",E,c(e(p)(e(b).subtotal)),1)]),e(D)?(d(!0),u($,{key:0},F(e(b).taxes,(o,i)=>(d(),u("p",M,[t("span",N,c(i)+": ",1),t("span",L,c(e(p)(o)),1)]))),256)):g("",!0),t("p",R,[z,t("span",P,c(e(p)(e(b).discount)),1)]),t("p",G,[H,t("span",J,c(e(p)(e(b).total)),1)]),m.payments&&m.payments.length?(d(),u("div",K,[(d(!0),u($,null,F(m.payments,o=>(d(),u("i",{class:"text-green-500 total-labels payment-label",key:o.id,onClick:O(i=>a.$emit("edit-payment",o),["stop"])},[t("span",U," Pagado en "+c(e(V)(o.payment_date)),1),t("span",W,"- "+c(e(p)(o.amount)),1)],8,Q))),128))])):g("",!0),t("p",X,[Y,t("span",Z,c(e(p)(e(y))),1)]),e(y)?I(a.$slots,"add-payment",{key:2,"slotScope:scope":{debt:e(y)}}):g("",!0)]))}};export{rt as default};
