import{z as f,s as T}from"./atmosphere-ui-86b7f8ed.js";import{I as g}from"./IconTrash-b225eb02.js";import{_ as D}from"./AtTable.vue_vue_type_script_setup_true_lang-805493b4.js";import{f as A}from"./formatMoney-b7ef7683.js";import{l as U,z as E,d as $,q,B,f as y,b as u,a1 as R,w as m,u as r,o as x,a as p,D as I,F as G,j as M,h as N,t as b,c as z}from"./app-e7293397.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";import"./customCell-f0a6687f.js";const w=[{label:"DescripciÃ³n",name:"item",type:"custom",fixed:"true",class:"text-left",headerClass:"text-left"},{label:"Cant.",name:"quantity",width:"100",type:"custom",class:"text-right text-normal",headerClass:"text-right"},{label:"Discount %",name:"discount",width:"100",type:"custom",class:"text-right",headerClass:"text-right"},{label:"Monto",name:"price",width:"150",type:"custom",class:"text-right",headerClass:"text-right"},{label:"Descuento",name:"taxes",width:"150",type:"custom",class:"text-center",headerClass:"text-center",render(t){var i;return(i=t.taxes)==null?void 0:i.map(o=>o.label+" "+o.rate+"%").join(", ")}},{label:"Total",name:"amount",width:"120",type:"calc",class:"text-right",headerClass:"text-right",formula(t){const i=Number(t.discount,0);t.subtotal=t.quantity*t.price,t.discountTotal=t.subtotal*i/100;const o=t.subtotal-t.discountTotal;return t.amount=o,A(o)}},{name:"actions"}],S={class:"w-full"},j={class:"d-flex"},F={key:1},L={class:"space-y-2"},P=["onClick"],H=["onClick"],J=U({__name:"InvoiceGrid",props:{tableData:{type:Array,default(){return[]}},availableTaxes:{type:Array,default(){return[]}},products:{type:Array,default(){return[]}},resourceUrl:{type:String,default:"/services?filter[name]=%${query}%&relationships=stock"},isEditing:{type:Boolean,default:!0},taxes:{type:Array,default(){return[]}},hiddenCols:{type:Array,default(){return[]}}},emits:["taxes-updated"],setup(t,{emit:i}){const o=t,c=E({cleaveOptions:{percent:{numericOnly:!0,blocks:[3]},money:{decimal:".",thousands:",",precision:2,masked:!1}},services:[],isLoading:!1,rowToAdd:{},addMode:!1,renderedCols:$(()=>o.isEditing?w:w.filter(s=>s.name!="actions"))}),h=()=>{var l,e,a,n;const s=(l=c.rowToAdd.taxes)!=null&&l.length?c.rowToAdd.taxes:[];o.isEditing&&(!o.tableData.length||o.tableData.at(-1).concept)&&o.tableData.push({product_name:(e=c.rowToAdd)==null?void 0:e.name,concept:(a=c.rowToAdd)==null?void 0:a.name,product_id:c.rowToAdd.id,quantity:1,discount:0,price:((n=c.rowToAdd.price)==null?void 0:n.value)||0,amount:0,taxes:[...s,{id:"new"}]})},_=(s,l)=>{if(!confirm("Do you want to delete this?"))return;const a={...l};o.tableData.splice(s,1),i("deleted",a)},V=(s,l,e)=>{const a=o.tableData[s],n=o.availableTaxes.find(d=>e==d.name);a.taxes[l]=n,i("taxes-updated",{rowIndex:s,taxes:a.taxes})},k=(s,l)=>{const e=o.tableData[s];if(e.taxes.length>1){const a=e.taxes.filter((n,d)=>d!==l);i("taxes-updated",{rowIndex:s,taxes:a})}};q(()=>{h()});const{renderedCols:C,cleaveOptions:v}=B(c);return(s,l)=>(x(),y("div",S,[u(D,{"hidden-cols":t.hiddenCols,cols:r(C),tableData:t.tableData,"hide-empty-text":!0},R({item:m(({scope:e})=>[p("div",j,[t.isEditing?(x(),z(r(f),{key:0,name:"",modelValue:e.row.concept,"onUpdate:modelValue":a=>e.row.concept=a,class:"form-control",rounded:""},null,8,["modelValue","onUpdate:modelValue"])):(x(),y("span",F,b(e.row.concept),1))])]),_:2},[t.isEditing?{name:"quantity",fn:m(({scope:e})=>[u(r(f),{name:"",min:"1",type:"number",modelValue:e.row.quantity,"onUpdate:modelValue":a=>e.row.quantity=a,class:"text-right form-control",rounded:""},null,8,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0,t.isEditing?{name:"discount",fn:m(({scope:e})=>[u(r(f),{class:"text-right form-control",type:"number",max:"100",min:"0",rounded:"",options:r(v).percent,modelValue:e.row.discount,"onUpdate:modelValue":a=>e.row.discount=a},null,8,["options","modelValue","onUpdate:modelValue"])]),key:"1"}:void 0,t.isEditing?{name:"price",fn:m(({scope:e})=>[p("div",L,[u(r(f),I({modelValue:e.row.price,"onUpdate:modelValue":a=>e.row.price=a},r(v).money,{"number-format":"",rounded:"",class:"text-right"}),null,16,["modelValue","onUpdate:modelValue"])])]),key:"2"}:void 0,t.isEditing?{name:"taxes",fn:m(({scope:e})=>[(x(!0),y(G,null,M(e.row.taxes,(a,n)=>(x(),y("div",{class:"flex items-center w-full mx-auto",key:`tax-${n}`},[u(r(T),{options:t.availableTaxes,modelValue:e.row.taxes[n].tax_id,"onUpdate:modelValue":[d=>e.row.taxes[n].tax_id=d,d=>V(e.$index,n,d)],selected:e.row.taxes[n],"onUpdate:selected":d=>e.row.taxes[n]=d,placeholder:"Tax","option-template":"${name} - ${rate}%",label:"name","key-track":"id",class:"w-full"},null,8,["options","modelValue","onUpdate:modelValue","selected","onUpdate:selected"]),N(" "+b(a.name)+" ",1),p("button",{class:"h-10 px-2 mt-auto ml-2 transition border focus:outline-none hover:text-gray-900 hover:bg-gray-200",onClick:d=>k(e.$index,n)},[u(g,{class:"w-4 h-4 text-gray-400"})],8,P)]))),128))]),key:"3"}:void 0,t.isEditing?{name:"actions",fn:m(({scope:e})=>[p("button",{onClick:a=>_(e.$index,e.row),class:"invoice-grid__remove-row"},[u(g,{class:"w-4 h-4 text-gray-400"})],8,H)]),key:"4"}:void 0,t.isEditing?{name:"append",fn:m(()=>[p("button",{onClick:l[0]||(l[0]=e=>h()),class:"invoice-grid__add-row"},"Add Row")]),key:"5"}:void 0]),1032,["hidden-cols","cols","tableData"])]))}});const te=O(J,[["__scopeId","data-v-7ae573d5"]]);export{te as default};
