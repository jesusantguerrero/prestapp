import{l as q,z as B,d as y,m as D,B as C,f as u,a,t as c,u as e,F as $,j as F,g,k as I,o as d,p as O}from"./app-494b6f90.js";import{f as V}from"./index-9dc2d84c.js";import{e as k}from"./exact-math.node-f7579f9b.js";import{f as m}from"./formatMoney-b7ef7683.js";const w={class:"invoice-totals"},A={class:"total-labels"},E=a("span",{class:"label"},"Subtotal: ",-1),M={class:"value"},N={class:"total-labels"},L={class:"label"},R={class:"value"},z={class:"total-labels total-remark"},P=a("span",{class:"label"}," Total: ",-1),G={class:"value"},H={key:1},J=["onClick"],K={class:"label"},Q={class:"value"},U={class:"total-labels total-remark"},W=a("span",{class:"label"}," Deuda: ",-1),X={class:"value"},st=q({__name:"InvoiceTotals",props:{tableData:{type:Array,required:!0},subtotalField:{type:String,required:!0},discountField:{type:String,required:!0},payments:{type:Array},totalField:{type:String,required:!0},totalValues:{type:Object,required:!0},isTaxIncluded:{type:Boolean,default:!1}},emits:["edit-payment"],setup(_){const r=_,S=(s,t)=>k.formula(`(${s} / ((100 + ${t}) / 100))`),l=B({totals:y(()=>r.tableData.reduce((t,o)=>{const i=o[r.totalField];let f=0,p=0;return o.taxes.forEach(n=>{const T=`${n.label||n.name} ${n==null?void 0:n.rate}%`;if(T&&n.rate){const x=r.isTaxIncluded?S(i,n.rate):i,v=k.formula(`${x} * (${n.rate} / ${100})`)*(n.type??1);t.taxes[T]=(t.taxes[T]||0)+(v||0),t.taxesTotal+=v,f+=v,p+=x}}),p=p||i,t.subtotal+=p,t.discountTotal+=Number(o[r.discountField]),t.total+=k.add(p,f??0),t.taxesTotal+=f,t},{total:0,discountTotal:0,subtotal:0,taxesTotal:0,taxes:{}})),hasTaxes:y(()=>Object.keys(l.totals.taxes).length>0),paymentTotal:y(()=>r.payments&&r.payments.length?r.payments.reduce((s,t)=>s+=parseFloat(t.amount),0):0),debt:y(()=>l.totals.total-l.paymentTotal)});D(()=>l.totals,()=>{l.totals&&Object.keys(l.totals).length&&Object.keys(l.totals).forEach(s=>{r.totalValues[s]=l.totals[s]})},{deep:!0,immediate:!0});const{totals:b,debt:h,hasTaxes:j,paymentTotal:Y}=C(l);return(s,t)=>(d(),u("div",w,[a("p",A,[E,a("span",M,c(e(m)(e(b).subtotal)),1)]),e(j)?(d(!0),u($,{key:0},F(e(b).taxes,(o,i)=>(d(),u("p",N,[a("span",L,c(i)+": ",1),a("span",R,c(e(m)(o)),1)]))),256)):g("",!0),a("p",z,[P,a("span",G,c(e(m)(e(b).total)),1)]),_.payments&&_.payments.length?(d(),u("div",H,[(d(!0),u($,null,F(_.payments,o=>(d(),u("i",{class:"text-green-500 total-labels payment-label",key:o.id,onClick:O(i=>s.$emit("edit-payment",o),["stop"])},[a("span",K," Pagado en "+c(e(V)(o.payment_date)),1),a("span",Q,"- "+c(e(m)(o.amount)),1)],8,J))),128))])):g("",!0),a("p",U,[W,a("span",X,c(e(m)(e(h))),1)]),e(h)?I(s.$slots,"add-payment",{key:2,"slotScope:scope":{debt:e(h)}}):g("",!0)]))}});export{st as _};
