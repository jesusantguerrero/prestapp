import{z as T,l as F,k as U,P as B,r as S,c as V,w as s,C as M,o as x,b as n,a as m,u as d,t as g,g as D,h as v,E as $,R as j,H as w}from"./app-bdc0a90d.js";import{V as z}from"./atmosphere-ui-92e9addd.js";import{_ as C}from"./BaseSelect.vue_vue_type_script_setup_true_lang-f40618a6.js";/* empty css                                                   */import{_ as G}from"./BaseTable.vue_vue_type_style_index_0_lang-09933656.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-2eda9632.js";import"./AppLayout.vue_vue_type_style_index_0_lang-933d19bf.js";import I from"./LoanSectionNav-3940fab1.js";import{_ as k}from"./AppButton.vue_vue_type_script_setup_true_lang-fcb67ff4.js";import{f as P}from"./formatMoney-b7ef7683.js";import{a as E}from"./ClientForm.vue_vue_type_script_setup_true_lang-723236b8.js";import"./clientInteractions-f0f2fe2b.js";import{_ as J}from"./ButtonGroup.vue_vue_type_script_setup_true_lang-ad826ee3.js";import"./customCell-5778d740.js";import"./AppSearch.vue_vue_type_script_setup_true_lang-543932f6.js";import"./close-0030bbab.js";import"./AppSearchFilters-f0af399e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./PaymentFormModal.vue_vue_type_script_setup_true_lang-667d0b29.js";import"./PaymentGrid-0bd36832.js";/* empty css                                                                    */import"./mathHelper-db6605d5.js";import"./exact-math.node-0390b5bc.js";import"./constants-0a903a05.js";import"./AccountSelect.vue_vue_type_script_setup_true_lang-6ae29dfc.js";import"./index-c251e33c.js";import"./index-81f33ca2.js";import"./Modal.vue_vue_type_script_setup_true_lang-b383de19.js";import"./usePaymentModal-b60af107.js";import"./ClientFormModal.vue_vue_type_script_setup_true_lang-b2380174.js";import"./menus-2c7b33a0.js";import"./SectionNav.vue_vue_type_script_setup_true_lang-18ff5984.js";const O=o=>o.reduce((r,t)=>(r[(t==null?void 0:t.name)??t]=null,r),{}),R=(o,r)=>Object.entries(o).reduce((t,[l,i])=>(i&&(t[l]=i[r]),t),{}),q=(o,r,t="id")=>{const l=T(O(o));return F(()=>l,i=>{const b=R(i,t);console.log(b,i),r.get(location.pathname,{filters:b},{preserveState:!0})},{deep:!0}),l},A={class:"py-10 mx-auto sm:px-6 lg:px-8"},K={class:"flex space-x-4 w-full px-4 rounded-md bg-base-lvl-3"},L={class:"rounded-md bg-base-lvl-3 mt-4"},Q={class:"px-4 pb-10"},W=["onClick"],X={class:"w-full text-right space-x-4 pb-4"},Te=U({__name:"PaymentCenter",props:{invoices:null,loans:null,clients:null,currentTab:null},setup(o){const r=o,t=B({client:null,account:null,payments:[]}),l=q(["client","loan"],$),i=(c,a)=>{a.payment=a.amount_due},b=()=>{var e,_,h;const c=(e=payments.value)==null?void 0:e.reduce((p,u)=>(u.amount&&p.push({id:u.id,rent_id:u.rent_id,amount:u.payment,original_amount:u.amount}),p),[]);if(!c.length){j({type:"error",message:"Seleccione al menos un pago",title:"Error de pago"});return}const a=c[0].rent_id,y={client_id:(_=t.client)==null?void 0:_.id,account_id:(h=t.account)==null?void 0:h.id,rent_id:a,payments:c,total:c.reduce((p,u)=>p+parseFloat(u.amount),0)};w.post(`/properties/${a}/transactions/refund`,y).then(({data:p})=>{console.log(p)})},N={pending:{label:"Pendientes"},all:{label:"Todos"},payments:{label:"Pagos"}},f=S(r.currentTab);return F(f,()=>{$.reload({data:{tab:f.value}})}),(c,a)=>{const y=M("ElCheckbox");return x(),V(H,{title:"Centro de pago de prestamos"},{header:s(()=>[n(I,null,{actions:s(()=>[n(J,{values:N,modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e)},null,8,["modelValue"])]),_:1})]),default:s(()=>[m("main",A,[m("header",K,[n(E,{label:"Cliente",class:"w-full"},{default:s(()=>[n(C,{modelValue:d(l).client,"onUpdate:modelValue":a[1]||(a[1]=e=>d(l).client=e),options:o.clients,placeholder:"selecciona un cliente",label:"display_name","track-by":"id"},null,8,["modelValue","options"])]),_:1}),n(E,{label:"Categoria",class:"w-full"},{default:s(()=>[n(C,{modelValue:d(l).loan,"onUpdate:modelValue":a[2]||(a[2]=e=>d(l).loan=e),"track-by":"id",options:o.loans,"hide-selected":!1,"custom-label":e=>`Prestamo ${e.id} (${e.amount}) (debt: $${e.debt})`,placeholder:"selecciona una categoria"},null,8,["modelValue","options","custom-label"])]),_:1})]),m("section",L,[m("article",Q,[n(G,{cols:[{name:"loan_id",label:"Prestamo #"},{name:"client.display_name",label:"Cliente"},{name:"amount",label:"Monto del pagare",render(e){return d(P)(e.amount)}},{name:"amount_paid",label:"Balance",render(e){return d(P)(e.amount_due)}},{name:"payment",label:"Monto de reembolso"}],"table-data":o.invoices.data},{loan_id:s(({scope:{row:e}})=>[m("div",{class:"items-center space-x-2 flex cursor-pointer",onClick:_=>i(!e.amount,e)},[n(y,{"model-value":!!e.payment},null,8,["model-value"]),m("span",null," Prestamo #"+g(e.loan_id),1)],8,W)]),payment:s(({scope:{row:e}})=>[e.amount_due>0?(x(),V(d(z),{key:0,class:"rounded-md shadow-none border-body-1/10",modelValue:e.payment,"onUpdate:modelValue":_=>e.payment=_,"number-format":!0},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),m("span",null,g(e.amount_due),1)]),_:1},8,["cols","table-data"])]),m("footer",X,[n(k,null,{default:s(()=>[v(" Cancel")]),_:1}),n(k,{onClick:b},{default:s(()=>[v(" Guardar y Pagar")]),_:1})])])])]),_:1})}}});export{Te as default};
